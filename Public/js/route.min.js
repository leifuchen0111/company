$(document).ready(function() {
    checkBrowser();
    $("#restart").click(function() {
        var a = "";
        $("input[class='checkboxes']:checked").each(function() {
            a += "," + $(this).val()
        });
        a = a.substr(1);
        $("#portlet-config .modal-header h3").html("重启路由");
        $("#portlet-config .modal-body p").html("正在执行操作，请稍后");
        $("#portlet-config").css("display", "block");
        $.ajax({
            type: "get",
            dataType: "json",
            url: "/Home/ApMain/restart/id/" + a,
            success: function(b) {
                if (b.status == 'success') {
                    $("#portlet-config .modal-body p").html('<label class="alert-success">' + b.msg + "</label>")
                } else {
                    $("#portlet-config .modal-body p").html('<label class="alert">' + b.msg + "</label>")
                }
            },
            error: function() {
                $("#portlet-config .modal-body p").html('<label class="alert-error">系统检测到您没有改操作权限</label>')
            }
        })
    });
    $("button[class='close']").click(function() {
        $("#portlet-config").css("display", "none");
        location.reload()
    });

    $("ul li#del").click(function() {
        if (confirm("确认执行？")) {
            var a = "";
            $("input[class='checkboxes']:checked").each(function() {
                a += "," + $(this).val()
            });
            a = a.substr(1);
            var b = $(this).attr("action");
            b = b.substr(0, b.lastIndexOf(".")) + "/id/";
            $("#portlet-config .modal-header h3").html("删除操作");
            $("#portlet-config .modal-body p").html("正在删除中....");
            $("#portlet-config").css("display", "block");
            console.log(b+a);
            $.ajax({
                type: "get",
                dataType: "json",
                url: b + a,
                success: function(c) {
                    if (c.state == 0) {
                        $("#portlet-config .modal-body p").html('<label class="alert-success">' + c.msg + "</label>")
                    } else {
                        $("#portlet-config .modal-body p").html('<label class="alert alert-error">' + c.msg + "</label>")
                    }
                },
                error: function(c) {
                    $("#portlet-config .modal-body p").html('<label class="alert-error">服务器无响应</label>')
                }
            })
        } else {
            return false
        }
    });
    $("input[class*='checkboxes']").click(function() {
        var c = "";
        $("input[class='checkboxes']:checked").each(function() {
            c += "," + $(this).val()
        });
        c = c.substr(1);
        var a = $("ul li#edit").attr("action");
        if (a) {
            var b = a.lastIndexOf(".");
            a = a.substr(0, b);
            a = a + "?id=" + c;
            $("ul li#edit a").attr("href", a)
        }
    });
    $("input[class*='checkboxes']").click(function() {
        var c = "";
        $("input[class='checkboxes']:checked").each(function() {
            c += "," + $(this).val()
        });
        c = c.substr(1);
        var a = $("ul li#batch").attr("data-href");
        if (a) {
            var b = a.lastIndexOf(".");
            a = a.substr(0, b);
            a = a + "?id=" + c;
            $("ul li#batch a").attr("href", a)
        }
    });
    $("input[class*='checkboxes']").click(function() {
        var c = "";
        $("input[class='checkboxes']:checked").each(function() {
            c += "," + $(this).val()
        });
        c = c.substr(1);
        var a = $("ul li#reset").attr("data-href");
        if (a) {
            var b = a.lastIndexOf(".");
            a = a.substr(0, b);
            a = a + "?id=" + c;
            $("ul li#reset a").attr("href", a)
        }
    });
    $("#test input").css("margin-left", "30px;");
    $("input#all").click(function() {
        if ($(this).prop("checked")) {
            $(this).parent("legend").next("input").prop("checked", true)
        } else {
            $(this).parent().parent().children("input").prop("checked", false)
        }
    });
    $("input[class*=access]").click(function() {
        var b = 0;
        var c = $(this).parent().children("input").length;
        $(this).parent().children("input").each(function() {
            if (!$(this).prop("checked")) {
                b++
            }
        });
        if (b == c) {
            $(this).parent().children("legend").children().prop("checked", false)
        } else {
            $(this).parent().children("legend").children().prop("checked", true)
        }
    });
    $("select#selCSI").change(function() {
        var a = "type=" + $(this).val();
        $.ajax({
            type: "post",
            dataType: "json",
            data: a,
            url: "/Home/WebMag/getTpl_Ajax",
            success: function(b) {
                var f = "";
                var e = b.length;
                for (var c = 0; c < e; c++) {
                    f += '<div class="row-fluid">';
                    for (var d = 0; d < b[c].length; d++) {
                        f += '<div class="span3 button-next" onclick="choiceTpl($(this))">																<div class="item">																	<a class="fancybox-button"  data-rel="fancybox-button"  title="' + b[c][d]["tpl_name"] + '" href="javascript:;">																		<div class="zoom">																			<img src="' + b[c][d]["screenshot"] + '" class="selecttpl" alt="' + b[c][d]["tpl_name"] + '" title="' + b[c][d]["tpl_name"] + '">												<div class="zoom-icon"></div>																		</div>																	</a>																	<div  class="details">																		 <input type="radio" required  name="tpl_name" value="' + b[c][d]["tpl_name"] + '" />' + b[c][d]["tpl_name"] + "																	</div>																														</div>																	</div>"
                    }
                    f += '</div>														<div class="space10"></div>'
                }
                $("div#tab2").empty();
                $("div#tab2").append(f)
            },
            error: function() {
                console.log("服务器无响应..")
            }
        })
    });
    $("li#offLine").click(function() {
        var b = "";
        $("input[class='checkboxes']:checked").each(function() {
            b += "," + $(this).val()
        });
        b = b.substr(1);
        $("#portlet-config .modal-header h3").html("强制下线");
        $("#portlet-config .modal-body p").html("正在执行操作中...");
        $("#portlet-config").css("display", "block");
        var a = "id=" + b;
        var c = $(this).attr("action");
        $.ajax({
            url: c,
            type: "post",
            dataType: "json",
            data: a,
            success: function(d) {
                console.log(d);
                if (d.state == 0) {
                    $("#portlet-config .modal-body p").html('<label class="alert-success">' + d.msg + "</label>");
                    location.reload()
                } else {
                    $("#portlet-config .modal-body p").html('<label class="alert alert-error">' + d.msg + "</label>")
                }
            },
            error: function() {
                $("#portlet-config .modal-body p").html('<label class="alert-error">系统检测到您没有改操作权限</label>')
            }
        })
    });
    $("li.auditUser").click(function() {
        var b = "";
        $("input[class='checkboxes']:checked").each(function() {
            b += "," + $(this).val()
        });
        b = b.substr(1);
        $("#portlet-config .modal-header h3").html("新用户注册审核");
        $("#portlet-config .modal-body p").html("正在执行操作中...");
        $("#portlet-config").css("display", "block");
        var a = "id=" + b + "&act=" + $(this).attr("type");
        var c = $(this).attr("action");
        $.ajax({
            url: c,
            type: "post",
            dataType: "json",
            data: a,
            success: function(d) {
                console.log(d);
                if (d.state == 0) {
                    $("#portlet-config .modal-body p").html('<label class="alert-success">' + d.msg + "</label>");
                    location.reload()
                } else {
                    $("#portlet-config .modal-body p").html('<label class="alert alert-error">' + d.msg + "</label>")
                }
            },
            error: function() {
                $("#portlet-config .modal-body p").html('<label class="alert-error">系统检测到您没有改操作权限</label>')
            }
        })
    });
    $("#distribute").click(function() {
        var c = "";
        var a = $(this);
        $("input[class='checkboxes']:checked").each(function() {
            c += "," + $(this).val()
        });
        c = c.substr(1);
        $("#portlet-config .modal-header h3").html("分配路由器");
        $("#portlet-config .modal-body p").empty().append('<label>请输入正确用户名:</label><input  type="text" class="inputtxt input" name="distoUser" id="toUser"/>　<a id="disConfirm" class="btn green" href="javascript:;">确认</a>');
        $("#portlet-config").css("display", "block");
        var b;
        $("#toUser").blur(function() {
            b = $(this).val()
        });
        $("#disConfirm").click(function() {
            if (b.length < 1) {
                $("#portlet-config .modal-body p").html('<lable class="alert-error">请输入用户名！</label>')
            }
            $("#portlet-config .modal-body p").html('<lable class="">正在执行操作，请稍后...</label>');
            var d = "name=" + b + "&rid=" + c;
            $.ajax({
                url: "/Home/ApMain/fenp",
                data: d,
                type: "post",
                dataType: "json",
                success: function(e) {
                    if (e.status == 'success') {
                        $("#portlet-config .modal-body p").html('<lable class="alert-success">' + e.msg + "</label>")
                    } else {
                        $("#portlet-config .modal-body p").html('<lable class="alert-error">' + e.msg + "</label>")
                    }
                },
                error: function() {
                    $("#portlet-config .modal-body p").html('<lable class="alert-error">系统检测到您额米有该操作权限</label>')
                }
            })
        })
    });
    $("li#update").click(function() {
        var c = "";
        var b = $(this);
        $("input[class='checkboxes']:checked").each(function() {
            c += "," + $(this).val()
        });
        $("#portlet-config .modal-header h3").html("固件更新");
        $("#portlet-config .modal-body p").html('<lable class="">正在执行操作，请稍后...</label>');
        $("#portlet-config").css("display", "block");
        c = c.substr(1);
        var a = "id=" + c;
        $.ajax({
            url: "/Home/Fw/FwCheckUpd",
            data: a,
            type: "post",
            dataType: "json",
            success: function(d) {
                console.log(d);
                if (d.state == 0) {
                    $("#portlet-config .modal-body p").html('<lable class="alert-success">' + d.msg + "</label>")
                } else {
                    $("#portlet-config .modal-body p").html('<lable class="alert-error">' + d.msg + "</label>")
                }
            },
            error: function() {
                $("#portlet-config .modal-body p").html('<lable class="alert-error">系统检测到您没有改操作权限</label>')
            }
        })
    })
});
var deleteOne = function(a, b) {
    if (confirm("确认删除?") == false) {
        return false
    } else {
        $("#portlet-config .modal-header h3").html("删除操作");
        $("#portlet-config .modal-body p").html('<lable class="">正在执行操作，请稍后...</label>');
        $("#portlet-config").css("display", "block");
        $.ajax({
            type: "get",
            url: b + a,
            dataType: "json",
            success: function(c) {
                console.log(c);
                if (c.state == 0) {
                    $("#portlet-config .modal-body p").html('<lable class="alert-success">' + c.msg + "</label>")
                } else {
                    $("#portlet-config .modal-body p").html('<lable class="alert-error">' + c.msg + "</label>")
                }
            },
            error: function() {
                $("#portlet-config .modal-body p").html('<lable class="alert-error">系统检测到您没有改操作权限</label>')
            }
        })
    }
};
var checkBrowser = function(){
    var browser=navigator.appName
    var b_version=navigator.appVersion
    if(browser != 'Netscape')
    {
        $("#portlet-config .modal-header").empty();
        $("#portlet-config .modal-header").html("<h4>系统提示</h4>");
        $("#portlet-config .modal-body").html('<lable class="alert-danger">为了正常使用本系统，请使用谷歌浏览器<p><a' +
            ' class="btn btn-green" href="http://w.x.baidu.com/alading/anquan_soft_down_ub/14744">点击下载</a></p></label>');
        $('#portlet-config').show();
    }
}