!function(a){var c=function(e,f){this.init(e,f)};c.prototype={constructor:c,init:function(e,f){this.$element=a(e);this.options=a.extend({},a.fn.modalmanager.defaults,this.$element.data(),typeof f=="object"&&f);this.stack=[];this.backdropCount=0;if(this.options.resize){var g,h=this;a(window).on("resize.modal",function(){g&&clearTimeout(g);g=setTimeout(function(){for(var j=0;j<h.stack.length;j++){h.stack[j].isShown&&h.stack[j].layout()}},10)})}},createModal:function(e,f){a(e).modal(a.extend({manager:this},f))},appendModal:function(e){this.stack.push(e);var f=this;e.$element.on("show.modalmanager",d(function(g){var h=function(){e.isShown=true;var i=a.support.transition&&e.$element.hasClass("fade");f.$element.toggleClass("modal-open",f.hasOpenModal()).toggleClass("page-overflow",a(window).height()<f.$element.height());e.$parent=e.$element.parent();e.$container=f.createContainer(e);e.$element.appendTo(e.$container);f.backdrop(e,function(){e.$element.show();if(i){e.$element[0].offsetWidth}e.layout();e.$element.addClass("in").attr("aria-hidden",false);var j=function(){f.setFocus();e.$element.trigger("shown")};i?e.$element.one(a.support.transition.end,j):j()})};e.options.replace?f.replace(h):h()}));e.$element.on("hidden.modalmanager",d(function(g){f.backdrop(e);if(e.$backdrop){a.support.transition&&e.$element.hasClass("fade")?e.$backdrop.one(a.support.transition.end,function(){f.destroyModal(e)}):f.destroyModal(e)}else{f.destroyModal(e)}}));e.$element.on("destroy.modalmanager",d(function(g){f.removeModal(e)}))},destroyModal:function(f){f.destroy();var e=this.hasOpenModal();this.$element.toggleClass("modal-open",e);if(!e){this.$element.removeClass("page-overflow")}this.removeContainer(f);this.setFocus()},hasOpenModal:function(){for(var e=0;e<this.stack.length;e++){if(this.stack[e].isShown){return true}}return false},setFocus:function(){var f;for(var e=0;e<this.stack.length;e++){if(this.stack[e].isShown){f=this.stack[e]}}if(!f){return}f.focus()},removeModal:function(e){e.$element.off(".modalmanager");if(e.$backdrop){this.removeBackdrop(e)}this.stack.splice(this.getIndexOfModal(e),1)},getModalAt:function(e){return this.stack[e]},getIndexOfModal:function(f){for(var e=0;e<this.stack.length;e++){if(f===this.stack[e]){return e}}},replace:function(e){var g;for(var f=0;f<this.stack.length;f++){if(this.stack[f].isShown){g=this.stack[f]}}if(g){this.$backdropHandle=g.$backdrop;g.$backdrop=null;e&&g.$element.one("hidden",d(a.proxy(e,this)));g.hide()}else{if(e){e()}}},removeBackdrop:function(e){e.$backdrop.remove();e.$backdrop=null},createBackdrop:function(f){var e;if(!this.$backdropHandle){e=a('<div class="modal-backdrop '+f+'" />').appendTo(this.$element)}else{e=this.$backdropHandle;e.off(".modalmanager");this.$backdropHandle=null;this.isLoading&&this.removeSpinner()}return e},removeContainer:function(e){e.$container.remove();e.$container=null},createContainer:function(f){var e;e=a('<div class="modal-scrollable">').css("z-index",b("modal",f?this.getIndexOfModal(f):this.stack.length)).appendTo(this.$element);if(f&&f.options.backdrop!="static"){e.on("click.modal",d(function(g){f.hide()}))}else{if(f){e.on("click.modal",d(function(g){f.attention()}))}}return e},backdrop:function(h,f){var e=h.$element.hasClass("fade")?"fade":"",i=h.options.backdrop&&this.backdropCount<this.options.backdropLimit;if(h.isShown&&i){var g=a.support.transition&&e&&!this.$backdropHandle;h.$backdrop=this.createBackdrop(e);h.$backdrop.css("z-index",b("backdrop",this.getIndexOfModal(h)));if(g){h.$backdrop[0].offsetWidth}h.$backdrop.addClass("in");this.backdropCount+=1;g?h.$backdrop.one(a.support.transition.end,f):f()}else{if(!h.isShown&&h.$backdrop){h.$backdrop.removeClass("in");this.backdropCount-=1;var j=this;a.support.transition&&h.$element.hasClass("fade")?h.$backdrop.one(a.support.transition.end,function(){j.removeBackdrop(h)}):j.removeBackdrop(h)}else{if(f){f()}}}},removeSpinner:function(){this.$spinner&&this.$spinner.remove();this.$spinner=null;this.isLoading=false},removeLoading:function(){this.$backdropHandle&&this.$backdropHandle.remove();this.$backdropHandle=null;this.removeSpinner()},loading:function(f){f=f||function(){};this.$element.toggleClass("modal-open",!this.isLoading||this.hasOpenModal()).toggleClass("page-overflow",a(window).height()<this.$element.height());if(!this.isLoading){this.$backdropHandle=this.createBackdrop("fade");this.$backdropHandle[0].offsetWidth;this.$backdropHandle.css("z-index",b("backdrop",this.stack.length)).addClass("in");var e=a(this.options.spinner).css("z-index",b("modal",this.stack.length)).appendTo(this.$element).addClass("in");this.$spinner=a(this.createContainer()).append(e).on("click.modalmanager",a.proxy(this.loading,this));this.isLoading=true;a.support.transition?this.$backdropHandle.one(a.support.transition.end,f):f()}else{if(this.isLoading&&this.$backdropHandle){this.$backdropHandle.removeClass("in");var g=this;a.support.transition?this.$backdropHandle.one(a.support.transition.end,function(){g.removeLoading()}):g.removeLoading()}else{if(f){f(this.isLoading)}}}}};var b=(function(){var f,e={};return function(j,i){if(typeof f==="undefined"){var h=a('<div class="modal hide" />').appendTo("body"),g=a('<div class="modal-backdrop hide" />').appendTo("body");e.modal=+h.css("z-index");e.backdrop=+g.css("z-index");f=e.modal-e.backdrop;h.remove();g.remove();g=h=null}return e[j]+(f*i)}}());function d(e){return function(f){if(this===f.target){return e.apply(this,arguments)}}}a.fn.modalmanager=function(f,e){return this.each(function(){var g=a(this),h=g.data("modalmanager");if(!h){g.data("modalmanager",(h=new c(this,f)))}if(typeof f==="string"){h[f].apply(h,[].concat(e))}})};a.fn.modalmanager.defaults={backdropLimit:999,resize:true,spinner:'<div class="loading-spinner fade" style="width: 200px; margin-left: -100px;"><div class="progress progress-striped active"><div class="bar" style="width: 100%;"></div></div></div>'};a.fn.modalmanager.Constructor=c}(jQuery);