(function(a){var d=10;var e=0.95;function b(v){var f=null,y=null,s=null,g=null,h=null,x=false,j=null;var p=[];v.hooks.processOptions.push(function(C,B){if(B.series.pie.show){B.grid.show=false;if(B.series.pie.label.show=="auto"){if(B.legend.show){B.series.pie.label.show=false}else{B.series.pie.label.show=true}}if(B.series.pie.radius=="auto"){if(B.series.pie.label.show){B.series.pie.radius=3/4}else{B.series.pie.radius=1}}if(B.series.pie.tilt>1){B.series.pie.tilt=1}else{if(B.series.pie.tilt<0){B.series.pie.tilt=0}}}});v.hooks.bindEvents.push(function(D,B){var C=D.getOptions();if(C.series.pie.show){if(C.grid.hoverable){B.unbind("mousemove").mousemove(u)}if(C.grid.clickable){B.unbind("click").click(t)}}});v.hooks.processDatapoints.push(function(E,F,B,C){var D=E.getOptions();if(D.series.pie.show){w(E,F,B,C)}});v.hooks.drawOverlay.push(function(D,B){var C=D.getOptions();if(C.series.pie.show){m(D,B)}});v.hooks.draw.push(function(D,B){var C=D.getOptions();if(C.series.pie.show){k(D,B)}});function w(C,D,B){if(!x){x=true;f=C.getCanvas();y=a(f).parent();c=C.getOptions();C.setData(i(C.getData()))}}function i(D){var H=0,C=0,G=0,B=c.series.pie.combine.color,F=[];for(var E=0;E<D.length;++E){var I=D[E].data;if(a.isArray(I)&&I.length==1){I=I[0]}if(a.isArray(I)){if(!isNaN(parseFloat(I[1]))&&isFinite(I[1])){I[1]=+I[1]}else{I[1]=0}}else{if(!isNaN(parseFloat(I))&&isFinite(I)){I=[1,+I]}else{I=[1,0]}}D[E].data=[I]}for(var E=0;E<D.length;++E){H+=D[E].data[0][1]}for(var E=0;E<D.length;++E){var I=D[E].data[0][1];if(I/H<=c.series.pie.combine.threshold){C+=I;G++;if(!B){B=D[E].color}}}for(var E=0;E<D.length;++E){var I=D[E].data[0][1];if(G<2||I/H>c.series.pie.combine.threshold){F.push({data:[[1,I]],color:D[E].color,label:D[E].label,angle:I*Math.PI*2/H,percent:I/(H/100)})}}if(G>1){F.push({data:[[1,C]],color:B,label:c.series.pie.combine.label,angle:C*Math.PI*2/H,percent:C/(H/100)})}return F}function k(J,I){if(!y){return}var D=J.getPlaceholder().width(),C=J.getPlaceholder().height(),H=y.children().filter(".legend").children().width()||0;j=I;x=false;s=Math.min(D,C/c.series.pie.tilt)/2;h=C/2+c.series.pie.offset.top;g=D/2;if(c.series.pie.offset.left=="auto"){if(c.legend.position.match("w")){g+=H/2}else{g-=H/2}}else{g+=c.series.pie.offset.left}if(g<s){g=s}else{if(g>D-s){g=D-s}}var K=J.getData(),B=0;do{if(B>0){s*=e}B+=1;E();if(c.series.pie.tilt<=0.8){G()}}while(!F()&&B<d);if(B>=d){E();y.prepend("<div class='error'>Could not draw pie with labels contained inside canvas</div>")}if(J.setSeries&&J.insertLegend){J.setSeries(K);J.insertLegend()}function E(){j.clearRect(0,0,D,C);y.children().filter(".pieLabel, .pieLabelBackground").remove()}function G(){var P=c.series.pie.shadow.left;var Q=c.series.pie.shadow.top;var M=10;var L=c.series.pie.shadow.alpha;var O=c.series.pie.radius>1?c.series.pie.radius:s*c.series.pie.radius;if(O>=D/2-P||O*c.series.pie.tilt>=C/2-Q||O<=M){return}j.save();j.translate(P,Q);j.globalAlpha=L;j.fillStyle="#000";j.translate(g,h);j.scale(1,c.series.pie.tilt);for(var N=1;N<=M;N++){j.beginPath();j.arc(0,0,O,0,Math.PI*2,false);j.fill();O-=N}j.restore()}function F(){var Q=Math.PI*c.series.pie.startAngle;var P=c.series.pie.radius>1?c.series.pie.radius:s*c.series.pie.radius;j.save();j.translate(g,h);j.scale(1,c.series.pie.tilt);j.save();var L=Q;for(var O=0;O<K.length;++O){K[O].startAngle=L;N(K[O].angle,K[O].color,true)}j.restore();if(c.series.pie.stroke.width>0){j.save();j.lineWidth=c.series.pie.stroke.width;L=Q;for(var O=0;O<K.length;++O){N(K[O].angle,c.series.pie.stroke.color,false)}j.restore()}l(j);j.restore();if(c.series.pie.label.show){return M()}else{return true}function N(R,S,T){if(R<=0||isNaN(R)){return}if(T){j.fillStyle=S}else{j.strokeStyle=S;j.lineJoin="round"}j.beginPath();if(Math.abs(R-Math.PI*2)>1e-09){j.moveTo(0,0)}j.arc(0,0,P,L,L+R/2,false);j.arc(0,0,P,L+R/2,L+R,false);j.closePath();L+=R;if(T){j.fill()}else{j.stroke()}}function M(){var R=Q;var U=c.series.pie.label.radius>1?c.series.pie.label.radius:s*c.series.pie.label.radius;for(var T=0;T<K.length;++T){if(K[T].percent>=c.series.pie.label.threshold*100){if(!S(K[T],R,T)){return false}}R+=K[T].angle}return true;function S(af,ag,Y){if(af.data[0][1]==0){return true}var ac=c.legend.labelFormatter,ah,ad=c.series.pie.label.formatter;if(ac){ah=ac(af.label,af)}else{ah=af.label}if(ad){ah=ad(ah,af)}var W=((ag+af.angle)+ag)/2;var ai=g+Math.round(Math.cos(W)*U);var aj=h+Math.round(Math.sin(W)*U)*c.series.pie.tilt;var X="<span class='pieLabel' id='pieLabel"+Y+"' style='position:absolute;top:"+aj+"px;left:"+ai+"px;'>"+ah+"</span>";y.append(X);var Z=y.children("#pieLabel"+Y);var ab=(aj-Z.height()/2);var aa=(ai-Z.width()/2);Z.css("top",ab);Z.css("left",aa);if(0-ab>0||0-aa>0||C-(ab+Z.height())<0||D-(aa+Z.width())<0){return false}if(c.series.pie.label.background.opacity!=0){var V=c.series.pie.label.background.color;if(V==null){V=af.color}var ae="top:"+ab+"px;left:"+aa+"px;";a("<div class='pieLabelBackground' style='position:absolute;width:"+Z.width()+"px;height:"+Z.height()+"px;"+ae+"background-color:"+V+";'></div>").css("opacity",c.series.pie.label.background.opacity).insertBefore(Z)}return true}}}}function l(C){if(c.series.pie.innerRadius>0){C.save();var B=c.series.pie.innerRadius>1?c.series.pie.innerRadius:s*c.series.pie.innerRadius;C.globalCompositeOperation="destination-out";C.beginPath();C.fillStyle=c.series.pie.stroke.color;C.arc(0,0,B,0,Math.PI*2,false);C.fill();C.closePath();C.restore();C.save();C.beginPath();C.strokeStyle=c.series.pie.stroke.color;C.arc(0,0,B,0,Math.PI*2,false);C.stroke();C.closePath();C.restore()}}function r(F,G){for(var B=false,C=-1,E=F.length,D=E-1;++C<E;D=C){((F[C][1]<=G[1]&&G[1]<F[D][1])||(F[D][1]<=G[1]&&G[1]<F[C][1]))&&(G[0]<(F[D][0]-F[C][0])*(G[1]-F[C][1])/(F[D][1]-F[C][1])+F[C][0])&&(B=!B)}return B}function n(E,F){var T=v.getData(),G=v.getOptions(),R=G.series.pie.radius>1?G.series.pie.radius:s*G.series.pie.radius,U,V;for(var D=0;D<T.length;++D){var S=T[D];if(S.pie.show){j.save();j.beginPath();j.moveTo(0,0);j.arc(0,0,R,S.startAngle,S.startAngle+S.angle/2,false);j.arc(0,0,R,S.startAngle+S.angle/2,S.startAngle+S.angle,false);j.closePath();U=E-g;V=F-h;if(j.isPointInPath){if(j.isPointInPath(E-g,F-h)){j.restore();return{datapoint:[S.percent,S.data],dataIndex:0,series:S,seriesIndex:D}}}else{var H=R*Math.cos(S.startAngle),I=R*Math.sin(S.startAngle),J=R*Math.cos(S.startAngle+S.angle/4),K=R*Math.sin(S.startAngle+S.angle/4),L=R*Math.cos(S.startAngle+S.angle/2),M=R*Math.sin(S.startAngle+S.angle/2),N=R*Math.cos(S.startAngle+S.angle/1.5),O=R*Math.sin(S.startAngle+S.angle/1.5),P=R*Math.cos(S.startAngle+S.angle),Q=R*Math.sin(S.startAngle+S.angle),C=[[0,0],[H,I],[J,K],[L,M],[N,O],[P,Q]],B=[U,V];if(r(C,B)){j.restore();return{datapoint:[S.percent,S.data],dataIndex:0,series:S,seriesIndex:D}}}j.restore()}}return null}function u(B){z("plothover",B)}function t(B){z("plotclick",B)}function z(E,D){var I=v.offset();var B=parseInt(D.pageX-I.left);var C=parseInt(D.pageY-I.top);var H=n(B,C);if(c.grid.autoHighlight){for(var G=0;G<p.length;++G){var F=p[G];if(F.auto==E&&!(H&&F.series==H.series)){A(F.series)}}}if(H){o(H.series,E)}var J={pageX:D.pageX,pageY:D.pageY};y.trigger(E,[J,H])}function o(D,B){var C=q(D);if(C==-1){p.push({series:D,auto:B});v.triggerRedrawOverlay()}else{if(!B){p[C].auto=false}}}function A(C){if(C==null){p=[];v.triggerRedrawOverlay()}var B=q(C);if(B!=-1){p.splice(B,1);v.triggerRedrawOverlay()}}function q(D){for(var C=0;C<p.length;++C){var B=p[C];if(B.series==D){return C}}return -1}function m(F,D){var E=F.getOptions();var G=E.series.pie.radius>1?E.series.pie.radius:s*E.series.pie.radius;D.save();D.translate(g,h);D.scale(1,E.series.pie.tilt);for(var C=0;C<p.length;++C){B(p[C].series)}l(D);D.restore();function B(H){if(H.angle<=0||isNaN(H.angle)){return}D.fillStyle="rgba(255, 255, 255, "+E.series.pie.highlight.opacity+")";D.beginPath();if(Math.abs(H.angle-Math.PI*2)>1e-09){D.moveTo(0,0)}D.arc(0,0,G,H.startAngle,H.startAngle+H.angle/2,false);D.arc(0,0,G,H.startAngle+H.angle/2,H.startAngle+H.angle,false);D.closePath();D.fill()}}}var c={series:{pie:{show:false,radius:"auto",innerRadius:0,startAngle:3/2,tilt:1,shadow:{left:5,top:15,alpha:0.02},offset:{top:0,left:"auto"},stroke:{color:"#fff",width:1},label:{show:"auto",formatter:function(f,g){return"<div style='font-size:x-small;text-align:center;padding:2px;color:"+g.color+";'>"+f+"<br/>"+Math.round(g.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:0.5}}}};a.plot.plugins.push({init:b,options:c,name:"pie",version:"1.1"})})(jQuery);