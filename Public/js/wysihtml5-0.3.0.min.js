var wysihtml5={version:"0.3.0",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"\uFEFF",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,DELETE_KEY:46};window.rangy=(function(){var v="object",l="function",y="undefined";var j=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"];var i=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"];var x=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"];var w=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"];function o(A,B){var C=typeof A[B];return C==l||(!!(C==v&&A[B]))||C=="unknown"}function p(A,B){return !!(typeof A[B]==v&&A[B])}function q(A,B){return typeof A[B]!=y}function g(A){return function(C,D){var B=D.length;while(B--){if(!A(C,D[B])){return false}}return true}}var b=g(o);var c=g(p);var d=g(q);function r(A){return A&&b(A,w)&&d(A,x)}var a={version:"1.2.2",initialized:false,supported:true,util:{isHostMethod:o,isHostObject:p,isHostProperty:q,areHostMethods:b,areHostObjects:c,areHostProperties:d,isTextRange:r},features:{},modules:{},config:{alertOnWarn:false,preferTextRange:false}};function k(A){window.alert("Rangy not supported in your browser. Reason: "+A);a.initialized=true;a.supported=false}a.fail=k;function z(A){var B="Rangy warning: "+A;if(a.config.alertOnWarn){window.alert(B)}else{if(typeof window.console!=y&&typeof window.console.log!=y){window.console.log(B)}}}a.warn=z;if({}.hasOwnProperty){a.util.extend=function(B,C){for(var A in C){if(C.hasOwnProperty(A)){B[A]=C[A]}}}}else{k("hasOwnProperty not supported")}var n=[];var u=[];function m(){if(a.initialized){return}var H;var E=false,F=false;if(o(document,"createRange")){H=document.createRange();if(b(H,i)&&d(H,j)){E=true}H.detach()}var B=p(document,"body")?document.body:document.getElementsByTagName("body")[0];if(B&&o(B,"createTextRange")){H=B.createTextRange();if(r(H)){F=true}}if(!E&&!F){k("Neither Range nor TextRange are implemented")}a.initialized=true;a.features={implementsDomRange:E,implementsTextRange:F};var A=u.concat(n);for(var D=0,G=A.length;D<G;++D){try{A[D](a)}catch(C){if(p(window,"console")&&o(window.console,"log")){window.console.log("Init listener threw an exception. Continuing.",C)}}}}a.init=m;a.addInitListener=function(A){if(a.initialized){A(a)}else{n.push(A)}};var f=[];a.addCreateMissingNativeApiListener=function(A){f.push(A)};function e(C){C=C||window;m();for(var A=0,B=f.length;A<B;++A){f[A](C)}}a.createMissingNativeApi=e;function t(A){this.name=A;this.initialized=false;this.supported=false}t.prototype.fail=function(A){this.initialized=true;this.supported=false;throw new Error("Module '"+this.name+"' failed to load: "+A)};t.prototype.warn=function(A){a.warn("Module "+this.name+": "+A)};t.prototype.createError=function(A){return new Error("Error in Rangy "+this.name+" module: "+A)};a.createModule=function(C,A){var B=new t(C);a.modules[C]=B;u.push(function(D){A(D,B);B.initialized=true;B.supported=true})};a.requireModules=function(E){for(var A=0,B=E.length,C,D;A<B;++A){D=E[A];C=a.modules[D];if(!C||!(C instanceof t)){throw new Error("Module '"+D+"' not found")}if(!C.supported){throw new Error("Module '"+D+"' not supported")}}};var h=false;var s=function(A){if(!h){h=true;if(!a.initialized){m()}}};if(typeof window==y){k("No window found");return}if(typeof document==y){k("No document found");return}if(o(document,"addEventListener")){document.addEventListener("DOMContentLoaded",s,false)}if(o(window,"addEventListener")){window.addEventListener("load",s,false)}else{if(o(window,"attachEvent")){window.attachEvent("onload",s)}else{k("Window does not have required addEventListener or attachEvent method")}}return a})();rangy.createModule("DomUtil",function(a,x){var C="undefined";var D=a.util;if(!D.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])){x.fail("document missing a Node creation method")}if(!D.isHostMethod(document,"getElementsByTagName")){x.fail("document missing getElementsByTagName method")}var g=document.createElement("div");if(!D.areHostMethods(g,["insertBefore","appendChild","cloneNode"]||!D.areHostObjects(g,["previousSibling","nextSibling","childNodes","parentNode"]))){x.fail("Incomplete Element implementation")}if(!D.isHostProperty(g,"innerHTML")){x.fail("Element is missing innerHTML property")}var B=document.createTextNode("test");if(!D.areHostMethods(B,["splitText","deleteData","insertData","appendData","cloneNode"]||!D.areHostObjects(g,["previousSibling","nextSibling","childNodes","parentNode"])||!D.areHostProperties(B,["data"]))){x.fail("Incomplete Text Node implementation")}var b=function(E,G){var F=E.length;while(F--){if(E[F]===G){return true}}return false};function w(E){var F;return typeof E.namespaceURI==C||((F=E.namespaceURI)===null||F=="http://www.w3.org/1999/xhtml")}function z(E){var F=E.parentNode;return(F.nodeType==1)?F:null}function o(F){var E=0;while((F=F.previousSibling)){E++}return E}function p(F){var E;return v(F)?F.length:((E=F.childNodes)?E.length:0)}function k(G,H){var E=[],F;for(F=G;F;F=F.parentNode){E.push(F)}for(F=H;F;F=F.parentNode){if(b(E,F)){return F}}return null}function u(E,F,H){var G=H?F:F.parentNode;while(G){if(G===E){return true}else{G=G.parentNode}}return false}function j(G,E,I){var H,F=I?G:G.parentNode;while(F){H=F.parentNode;if(H===E){return F}F=H}return null}function v(E){var F=E.nodeType;return F==3||F==4||F==8}function s(F,H){var E=H.nextSibling,G=H.parentNode;if(E){G.insertBefore(F,E)}else{G.appendChild(F)}return F}function A(G,E){var F=G.cloneNode(false);F.deleteData(0,E);G.deleteData(E,G.length-E);s(F,G);return F}function l(E){if(E.nodeType==9){return E}else{if(typeof E.ownerDocument!=C){return E.ownerDocument}else{if(typeof E.document!=C){return E.document}else{if(E.parentNode){return l(E.parentNode)}else{throw new Error("getDocument: no document found for node")}}}}}function r(F){var E=l(F);if(typeof E.defaultView!=C){return E.defaultView}else{if(typeof E.parentWindow!=C){return E.parentWindow}else{throw new Error("Cannot get a window object for node")}}}function m(E){if(typeof E.contentDocument!=C){return E.contentDocument}else{if(typeof E.contentWindow!=C){return E.contentWindow.document}else{throw new Error("getIframeWindow: No Document object found for iframe element")}}}function n(E){if(typeof E.contentWindow!=C){return E.contentWindow}else{if(typeof E.contentDocument!=C){return E.contentDocument.defaultView}else{throw new Error("getIframeWindow: No Window object found for iframe element")}}}function i(E){return D.isHostObject(E,"body")?E.body:E.getElementsByTagName("body")[0]}function q(E){var F;while((F=E.parentNode)){E=F}return E}function c(H,K,I,L){var J,M,E,F,G;if(H==I){return K===L?0:(K<L)?-1:1}else{if((J=j(I,H,true))){return K<=o(J)?-1:1}else{if((J=j(H,I,true))){return o(J)<L?-1:1}else{M=k(H,I);E=(H===M)?M:j(H,M,true);F=(I===M)?M:j(I,M,true);if(E===F){throw new Error("comparePoints got to case 4 and childA and childB are the same!")}else{G=M.firstChild;while(G){if(G===E){return -1}else{if(G===F){return 1}}G=G.nextSibling}throw new Error("Should not be here!")}}}}}function h(G){var F=l(G).createDocumentFragment(),E;while((E=G.firstChild)){F.appendChild(E)}return F}function t(F){if(!F){return"[No node]"}if(v(F)){return'"'+F.data+'"'}else{if(F.nodeType==1){var E=F.id?' id="'+F.id+'"':"";return"<"+F.nodeName+E+">["+F.childNodes.length+"]"}else{return F.nodeName}}}function y(E){this.root=E;this._next=E}y.prototype={_current:null,hasNext:function(){return !!this._next},next:function(){var F=this._current=this._next;var E,G;if(this._current){E=F.firstChild;if(E){this._next=E}else{G=null;while((F!==this.root)&&!(G=F.nextSibling)){F=F.parentNode}this._next=G}}return this._current},detach:function(){this._current=this._next=this.root=null}};function d(E){return new y(E)}function f(E,F){this.node=E;this.offset=F}f.prototype={equals:function(E){return this.node===E.node&this.offset==E.offset},inspect:function(){return"[DomPosition("+t(this.node)+":"+this.offset+")]"}};function e(E){this.code=this[E];this.codeName=E;this.message="DOMException: "+this.codeName}e.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11};e.prototype.toString=function(){return this.message};a.dom={arrayContains:b,isHtmlNamespace:w,parentElement:z,getNodeIndex:o,getNodeLength:p,getCommonAncestor:k,isAncestorOf:u,getClosestAncestorIn:j,isCharacterDataNode:v,insertAfter:s,splitDataNode:A,getDocument:l,getWindow:r,getIframeWindow:n,getIframeDocument:m,getBody:i,getRootContainer:q,comparePoints:c,inspectNode:t,fragmentFromNodeChildren:h,createIterator:d,DomPosition:f};a.DOMException=e});rangy.createModule("DomRange",function(a,S){a.requireModules(["DomUtil"]);var v=a.dom;var x=v.DomPosition;var w=a.DOMException;function O(e,al){return(e.nodeType!=3)&&(v.isAncestorOf(e,al.startContainer,true)||v.isAncestorOf(e,al.endContainer,true))}function H(e){return v.getDocument(e.startContainer)}function u(ao,ap,e){var an=ao._listeners[ap];if(an){for(var al=0,am=an.length;al<am;++al){an[al].call(ao,{target:ao,args:e})}}}function D(e){return new x(e.parentNode,v.getNodeIndex(e))}function C(e){return new x(e.parentNode,v.getNodeIndex(e)+1)}function M(am,al,an){var e=am.nodeType==11?am.firstChild:am;if(v.isCharacterDataNode(al)){if(an==al.length){v.insertAfter(am,al)}else{al.parentNode.insertBefore(am,an==0?al:v.splitDataNode(al,an))}}else{if(an>=al.childNodes.length){al.appendChild(am)}else{al.insertBefore(am,al.childNodes[an])}}return e}function l(al){var an;for(var am,e=H(al.range).createDocumentFragment(),ao;am=al.next();){an=al.isPartiallySelectedSubtree();am=am.cloneNode(!an);if(an){ao=al.getSubtreeIterator();am.appendChild(l(ao));ao.detach(true)}if(am.nodeType==10){throw new w("HIERARCHY_REQUEST_ERR")}e.appendChild(am)}return e}function R(ap,e,am){var al,an;am=am||{stop:false};for(var ao,aq;ao=ap.next();){if(ap.isPartiallySelectedSubtree()){if(e(ao)===false){am.stop=true;return}else{aq=ap.getSubtreeIterator();R(aq,e,am);aq.detach(true);if(am.stop){return}}}else{al=v.createIterator(ao);while((an=al.next())){if(e(an)===false){am.stop=true;return}}}}}function s(e){var al;while(e.next()){if(e.isPartiallySelectedSubtree()){al=e.getSubtreeIterator();s(al);al.detach(true)}else{e.remove()}}}function B(al){for(var am,e=H(al.range).createDocumentFragment(),an;am=al.next();){if(al.isPartiallySelectedSubtree()){am=am.cloneNode(false);an=al.getSubtreeIterator();am.appendChild(B(an));an.detach(true)}else{al.remove()}if(am.nodeType==10){throw new w("HIERARCHY_REQUEST_ERR")}e.appendChild(am)}return e}function G(ap,ao,e){var am=!!(ao&&ao.length),aq;var al=!!e;if(am){aq=new RegExp("^("+ao.join("|")+")$")}var an=[];R(new Z(ap,false),function(ar){if((!am||aq.test(ar.nodeType))&&(!al||e(ar))){an.push(ar)}});return an}function N(al){var e=(typeof al.getName=="undefined")?"Range":al.getName();return"["+e+"("+v.inspectNode(al.startContainer)+":"+al.startOffset+", "+v.inspectNode(al.endContainer)+":"+al.endOffset+")]"}function Z(al,e){this.range=al;this.clonePartiallySelectedTextNodes=e;if(!al.collapsed){this.sc=al.startContainer;this.so=al.startOffset;this.ec=al.endContainer;this.eo=al.endOffset;var am=al.commonAncestorContainer;if(this.sc===this.ec&&v.isCharacterDataNode(this.sc)){this.isSingleCharacterDataNode=true;this._first=this._last=this._next=this.sc}else{this._first=this._next=(this.sc===am&&!v.isCharacterDataNode(this.sc))?this.sc.childNodes[this.so]:v.getClosestAncestorIn(this.sc,am,true);this._last=(this.ec===am&&!v.isCharacterDataNode(this.ec))?this.ec.childNodes[this.eo-1]:v.getClosestAncestorIn(this.ec,am,true)}}}Z.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:false,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return !!this._next},next:function(){var e=this._current=this._next;if(e){this._next=(e!==this._last)?e.nextSibling:null;if(v.isCharacterDataNode(e)&&this.clonePartiallySelectedTextNodes){if(e===this.ec){(e=e.cloneNode(true)).deleteData(this.eo,e.length-this.eo)}if(this._current===this.sc){(e=e.cloneNode(true)).deleteData(0,this.so)}}}return e},remove:function(){var e=this._current,am,al;if(v.isCharacterDataNode(e)&&(e===this.sc||e===this.ec)){am=(e===this.sc)?this.so:0;al=(e===this.ec)?this.eo:e.length;if(am!=al){e.deleteData(am,al-am)}}else{if(e.parentNode){e.parentNode.removeChild(e)}else{}}},isPartiallySelectedSubtree:function(){var e=this._current;return O(e,this.range)},getSubtreeIterator:function(){var ap;if(this.isSingleCharacterDataNode){ap=this.range.cloneRange();ap.collapse()}else{ap=new X(H(this.range));var e=this._current;var an=e,ao=0,al=e,am=v.getNodeLength(e);if(v.isAncestorOf(e,this.sc,true)){an=this.sc;ao=this.so}if(v.isAncestorOf(e,this.ec,true)){al=this.ec;am=this.eo}aj(ap,an,ao,al,am)}return new Z(ap,this.clonePartiallySelectedTextNodes)},detach:function(e){if(e){this.range.detach()}this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};function Y(e){this.code=this[e];this.codeName=e;this.message="RangeException: "+this.codeName}Y.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};Y.prototype.toString=function(){return this.message};function aa(am,al,e){this.nodes=G(am,al,e);this._next=this.nodes[0];this._position=0}aa.prototype={_current:null,hasNext:function(){return !!this._next},next:function(){this._current=this._next;this._next=this.nodes[++this._position];return this._current},detach:function(){this._current=this._next=this.nodes=null}};var k=[1,3,4,5,7,8,10];var ae=[2,9,11];var ad=[5,6,10,12];var L=[1,3,4,5,7,8,10,11];var ai=[1,3,4,5,7,8];function o(e){return function(am,an){var ao,al=an?am:am.parentNode;while(al){ao=al.nodeType;if(v.arrayContains(e,ao)){return al}al=al.parentNode}return null}}var J=v.getRootContainer;var F=o([9,11]);var I=o(ad);var E=o([6,10,12]);function d(al,e){if(E(al,e)){throw new Y("INVALID_NODE_TYPE_ERR")}}function f(e){if(!e.startContainer){throw new w("INVALID_STATE_ERR")}}function i(al,e){if(!v.arrayContains(e,al.nodeType)){throw new Y("INVALID_NODE_TYPE_ERR")}}function j(e,al){if(al<0||al>(v.isCharacterDataNode(e)?e.length:e.childNodes.length)){throw new w("INDEX_SIZE_ERR")}}function h(e,al){if(F(e,true)!==F(al,true)){throw new w("WRONG_DOCUMENT_ERR")}}function c(e){if(I(e,true)){throw new w("NO_MODIFICATION_ALLOWED_ERR")}}function b(al,e){if(!al){throw new w(e)}}function P(e){return !v.arrayContains(ae,e.nodeType)&&!F(e,true)}function Q(e,al){return al<=(v.isCharacterDataNode(e)?e.length:e.childNodes.length)}function g(e){f(e);if(P(e.startContainer)||P(e.endContainer)||!Q(e.startContainer,e.startOffset)||!Q(e.endContainer,e.endOffset)){throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}}var ah=document.createElement("style");var K=false;try{ah.innerHTML="<b>x</b>";K=(ah.firstChild.nodeType==3)}catch(y){}a.features.htmlParsingConforms=K;var p=K?function(am){var an=this.startContainer;var e=v.getDocument(an);if(!an){throw new w("INVALID_STATE_ERR")}var al=null;if(an.nodeType==1){al=an}else{if(v.isCharacterDataNode(an)){al=v.parentElement(an)}}if(al===null||(al.nodeName=="HTML"&&v.isHtmlNamespace(v.getDocument(al).documentElement)&&v.isHtmlNamespace(al))){al=e.createElement("body")}else{al=al.cloneNode(false)}al.innerHTML=am;return v.fragmentFromNodeChildren(al)}:function(am){f(this);var e=H(this);var al=e.createElement("body");al.innerHTML=am;return v.fragmentFromNodeChildren(al)};var ab=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"];var ag=0,af=1,z=2,A=3;var U=0,T=1,V=2,W=3;function ac(){}ac.prototype={attachListener:function(al,e){this._listeners[al].push(e)},compareBoundaryPoints:function(e,ar){g(this);h(this.startContainer,ar.startContainer);var al,an,am,ao;var ap=(e==A||e==ag)?"start":"end";var aq=(e==af||e==ag)?"start":"end";al=this[ap+"Container"];an=this[ap+"Offset"];am=ar[aq+"Container"];ao=ar[aq+"Offset"];return v.comparePoints(al,an,am,ao)},insertNode:function(al){g(this);i(al,L);c(this.startContainer);if(v.isAncestorOf(al,this.startContainer,true)){throw new w("HIERARCHY_REQUEST_ERR")}var e=M(al,this.startContainer,this.startOffset);this.setStartBefore(e)},cloneContents:function(){g(this);var e,al;if(this.collapsed){return H(this).createDocumentFragment()}else{if(this.startContainer===this.endContainer&&v.isCharacterDataNode(this.startContainer)){e=this.startContainer.cloneNode(true);e.data=e.data.slice(this.startOffset,this.endOffset);al=H(this).createDocumentFragment();al.appendChild(e);return al}else{var am=new Z(this,true);e=l(am);am.detach()}return e}},canSurroundContents:function(){g(this);c(this.startContainer);c(this.endContainer);var al=new Z(this,true);var e=(al._first&&(O(al._first,this))||(al._last&&O(al._last,this)));al.detach();return !e},surroundContents:function(al){i(al,ai);if(!this.canSurroundContents()){throw new Y("BAD_BOUNDARYPOINTS_ERR")}var e=this.extractContents();if(al.hasChildNodes()){while(al.lastChild){al.removeChild(al.lastChild)}}M(al,this.startContainer,this.startOffset);al.appendChild(e);this.selectNode(al)},cloneRange:function(){g(this);var am=new X(H(this));var e=ab.length,al;while(e--){al=ab[e];am[al]=this[al]}return am},toString:function(){g(this);var al=this.startContainer;if(al===this.endContainer&&v.isCharacterDataNode(al)){return(al.nodeType==3||al.nodeType==4)?al.data.slice(this.startOffset,this.endOffset):""}else{var am=[],e=new Z(this,true);R(e,function(an){if(an.nodeType==3||an.nodeType==4){am.push(an.data)}});e.detach();return am.join("")}},compareNode:function(al){g(this);var an=al.parentNode;var am=v.getNodeIndex(al);if(!an){throw new w("NOT_FOUND_ERR")}var ao=this.comparePoint(an,am),e=this.comparePoint(an,am+1);if(ao<0){return(e>0)?V:U}else{return(e>0)?T:W}},comparePoint:function(e,al){g(this);b(e,"HIERARCHY_REQUEST_ERR");h(e,this.startContainer);if(v.comparePoints(e,al,this.startContainer,this.startOffset)<0){return -1}else{if(v.comparePoints(e,al,this.endContainer,this.endOffset)>0){return 1}}return 0},createContextualFragment:p,toHtml:function(){g(this);var e=H(this).createElement("div");e.appendChild(this.cloneContents());return e.innerHTML},intersectsNode:function(al,ap){g(this);b(al,"NOT_FOUND_ERR");if(v.getDocument(al)!==H(this)){return false}var an=al.parentNode,am=v.getNodeIndex(al);b(an,"NOT_FOUND_ERR");var ao=v.comparePoints(an,am,this.endContainer,this.endOffset),e=v.comparePoints(an,am+1,this.startContainer,this.startOffset);return ap?ao<=0&&e>=0:ao<0&&e>0},isPointInRange:function(e,al){g(this);b(e,"HIERARCHY_REQUEST_ERR");h(e,this.startContainer);return(v.comparePoints(e,al,this.startContainer,this.startOffset)>=0)&&(v.comparePoints(e,al,this.endContainer,this.endOffset)<=0)},intersectsRange:function(al,an){g(this);if(H(al)!=H(this)){throw new w("WRONG_DOCUMENT_ERR")}var am=v.comparePoints(this.startContainer,this.startOffset,al.endContainer,al.endOffset),e=v.comparePoints(this.endContainer,this.endOffset,al.startContainer,al.startOffset);return an?am<=0&&e>=0:am<0&&e>0},intersection:function(am){if(this.intersectsRange(am)){var an=v.comparePoints(this.startContainer,this.startOffset,am.startContainer,am.startOffset),e=v.comparePoints(this.endContainer,this.endOffset,am.endContainer,am.endOffset);var al=this.cloneRange();if(an==-1){al.setStart(am.startContainer,am.startOffset)}if(e==1){al.setEnd(am.endContainer,am.endOffset)}return al}return null},union:function(e){if(this.intersectsRange(e,true)){var al=this.cloneRange();if(v.comparePoints(e.startContainer,e.startOffset,this.startContainer,this.startOffset)==-1){al.setStart(e.startContainer,e.startOffset)}if(v.comparePoints(e.endContainer,e.endOffset,this.endContainer,this.endOffset)==1){al.setEnd(e.endContainer,e.endOffset)}return al}else{throw new Y("Ranges do not intersect")}},containsNode:function(al,e){if(e){return this.intersectsNode(al,false)}else{return this.compareNode(al)==W}},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,v.getNodeLength(e))<=0},containsRange:function(e){return this.intersection(e).equals(e)},containsNodeText:function(am){var an=this.cloneRange();an.selectNode(am);var ao=an.getNodes([3]);if(ao.length>0){an.setStart(ao[0],0);var al=ao.pop();an.setEnd(al,al.length);var e=this.containsRange(an);an.detach();return e}else{return this.containsNodeContents(am)}},createNodeIterator:function(al,e){g(this);return new aa(this,al,e)},getNodes:function(al,e){g(this);return G(this,al,e)},getDocument:function(){return H(this)},collapseBefore:function(e){f(this);this.setEndBefore(e);this.collapse(false)},collapseAfter:function(e){f(this);this.setStartAfter(e);this.collapse(true)},getName:function(){return"DomRange"},equals:function(e){return X.rangesEqual(this,e)},inspect:function(){return N(this)}};function n(e){e.START_TO_START=ag;e.START_TO_END=af;e.END_TO_END=z;e.END_TO_START=A;e.NODE_BEFORE=U;e.NODE_AFTER=T;e.NODE_BEFORE_AND_AFTER=V;e.NODE_INSIDE=W}function m(e){n(e);n(e.prototype)}function r(al,e){return function(){g(this);var ar=this.startContainer,at=this.startOffset,aq=this.commonAncestorContainer;var an=new Z(this,true);var ao,am;if(ar!==aq){ao=v.getClosestAncestorIn(ar,aq,true);am=C(ao);ar=am.node;at=am.offset}R(an,c);an.reset();var ap=al(an);an.detach();e(this,ar,at,ar,at);return ap}}function q(al,e,an){function am(ar,at){return function(av){f(this);i(av,k);i(J(av),ae);var au=(ar?D:C)(av);(at?ap:ao)(this,au.node,au.offset)}}function ap(aw,au,av){var ar=aw.endContainer,at=aw.endOffset;if(au!==aw.startContainer||av!==aw.startOffset){if(J(au)!=J(ar)||v.comparePoints(au,av,ar,at)==1){ar=au;at=av}e(aw,au,av,ar,at)}}function ao(au,ar,at){var av=au.startContainer,aw=au.startOffset;if(ar!==au.endContainer||at!==au.endOffset){if(J(ar)!=J(av)||v.comparePoints(ar,at,av,aw)==-1){av=ar;aw=at}e(au,av,aw,ar,at)}}function aq(au,ar,at){if(ar!==au.startContainer||at!==au.startOffset||ar!==au.endContainer||at!==au.endOffset){e(au,ar,at,ar,at)}}al.prototype=new ac();a.util.extend(al.prototype,{setStart:function(ar,at){f(this);d(ar,true);j(ar,at);ap(this,ar,at)},setEnd:function(ar,at){f(this);d(ar,true);j(ar,at);ao(this,ar,at)},setStartBefore:am(true,true),setStartAfter:am(false,true),setEndBefore:am(true,false),setEndAfter:am(false,false),collapse:function(ar){g(this);if(ar){e(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset)}else{e(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)}},selectNodeContents:function(ar){f(this);d(ar,true);e(this,ar,0,ar,v.getNodeLength(ar))},selectNode:function(at){f(this);d(at,false);i(at,k);var au=D(at),ar=C(at);e(this,au.node,au.offset,ar.node,ar.offset)},extractContents:r(B,e),deleteContents:r(s,e),canSurroundContents:function(){g(this);c(this.startContainer);c(this.endContainer);var at=new Z(this,true);var ar=(at._first&&(O(at._first,this))||(at._last&&O(at._last,this)));at.detach();return !ar},detach:function(){an(this)},splitBoundaries:function(){g(this);var au=this.startContainer,av=this.startOffset,ar=this.endContainer,at=this.endOffset;var aw=(au===ar);if(v.isCharacterDataNode(ar)&&at>0&&at<ar.length){v.splitDataNode(ar,at)}if(v.isCharacterDataNode(au)&&av>0&&av<au.length){au=v.splitDataNode(au,av);if(aw){at-=av;ar=au}else{if(ar==au.parentNode&&at>=v.getNodeIndex(au)){at++}}av=0}e(this,au,av,ar,at)},normalizeBoundaries:function(){g(this);var ay=this.startContainer,az=this.startOffset,ar=this.endContainer,au=this.endOffset;var aw=function(aB){var aC=aB.nextSibling;if(aC&&aC.nodeType==aB.nodeType){ar=aB;au=aB.length;aB.appendData(aC.data);aC.parentNode.removeChild(aC)}};var av=function(aB){var aE=aB.previousSibling;if(aE&&aE.nodeType==aB.nodeType){ay=aB;var aD=aB.length;az=aE.length;aB.insertData(0,aE.data);aE.parentNode.removeChild(aE);if(ay==ar){au+=az;ar=ay}else{if(ar==aB.parentNode){var aC=v.getNodeIndex(aB);if(au==aC){ar=aB;au=aD}else{if(au>aC){au--}}}}}};var ax=true;if(v.isCharacterDataNode(ar)){if(ar.length==au){aw(ar)}}else{if(au>0){var at=ar.childNodes[au-1];if(at&&v.isCharacterDataNode(at)){aw(at)}}ax=!this.collapsed}if(ax){if(v.isCharacterDataNode(ay)){if(az==0){av(ay)}}else{if(az<ay.childNodes.length){var aA=ay.childNodes[az];if(aA&&v.isCharacterDataNode(aA)){av(aA)}}}}else{ay=ar;az=au}e(this,ay,az,ar,au)},collapseToPoint:function(ar,at){f(this);d(ar,true);j(ar,at);aq(this,ar,at)}});m(al)}function ak(e){e.collapsed=(e.startContainer===e.endContainer&&e.startOffset===e.endOffset);e.commonAncestorContainer=e.collapsed?e.startContainer:v.getCommonAncestor(e.startContainer,e.endContainer)}function aj(an,ao,aq,e,am){var ap=(an.startContainer!==ao||an.startOffset!==aq);var al=(an.endContainer!==e||an.endOffset!==am);an.startContainer=ao;an.startOffset=aq;an.endContainer=e;an.endOffset=am;ak(an);u(an,"boundarychange",{startMoved:ap,endMoved:al})}function t(e){f(e);e.startContainer=e.startOffset=e.endContainer=e.endOffset=null;e.collapsed=e.commonAncestorContainer=null;u(e,"detach",null);e._listeners=null}function X(e){this.startContainer=e;this.startOffset=0;this.endContainer=e;this.endOffset=0;this._listeners={boundarychange:[],detach:[]};ak(this)}q(X,aj,t);a.rangePrototype=ac.prototype;X.rangeProperties=ab;X.RangeIterator=Z;X.copyComparisonConstants=m;X.createPrototypeRange=q;X.inspect=N;X.getRangeDocument=H;X.rangesEqual=function(e,al){return e.startContainer===al.startContainer&&e.startOffset===al.startOffset&&e.endContainer===al.endContainer&&e.endOffset===al.endOffset};a.DomRange=X;a.RangeException=Y});rangy.createModule("WrappedRange",function(a,i){a.requireModules(["DomUtil","DomRange"]);var k;var c=a.dom;var d=c.DomPosition;var e=a.DomRange;function g(q){var m=q.parentElement();var n=q.duplicate();n.collapse(true);var o=n.parentElement();n=q.duplicate();n.collapse(false);var l=n.parentElement();var p=(o==l)?o:c.getCommonAncestor(o,l);return p==m?p:c.getCommonAncestor(m,p)}function j(l){return l.compareEndPoints("StartToEnd",l)==0}function f(w,x,q,p){var A=w.duplicate();A.collapse(q);var o=A.parentElement();if(!c.isAncestorOf(x,o,true)){o=x}if(!o.canHaveHTML){return new d(o.parentNode,c.getNodeIndex(o))}var z=c.getDocument(o).createElement("span");var n,y=q?"StartToStart":"StartToEnd";var t,r,m,l;do{o.insertBefore(z,z.previousSibling);A.moveToElementText(z)}while((n=A.compareEndPoints(y,w))>0&&z.previousSibling);l=z.nextSibling;if(n==-1&&l&&c.isCharacterDataNode(l)){A.setEndPoint(q?"EndToStart":"EndToEnd",w);var s;if(/[\r\n]/.test(l.data)){var v=A.duplicate();var u=v.text.replace(/\r\n/g,"\r").length;s=v.moveStart("character",u);while((n=v.compareEndPoints("StartToEnd",v))==-1){s++;v.moveStart("character",1)}}else{s=A.text.length}m=new d(l,s)}else{t=(p||!q)&&z.previousSibling;r=(p||q)&&z.nextSibling;if(r&&c.isCharacterDataNode(r)){m=new d(r,0)}else{if(t&&c.isCharacterDataNode(t)){m=new d(t,t.length)}else{m=new d(o,c.getNodeIndex(z))}}}z.parentNode.removeChild(z);return m}function b(o,r){var l,n,m=o.offset;var q=c.getDocument(o.node);var t,p,u=q.body.createTextRange();var s=c.isCharacterDataNode(o.node);if(s){l=o.node;n=l.parentNode}else{p=o.node.childNodes;l=(m<p.length)?p[m]:null;n=o.node}t=q.createElement("span");t.innerHTML="&#feff;";if(l){n.insertBefore(t,l)}else{n.appendChild(t)}u.moveToElementText(t);u.collapse(!r);n.removeChild(t);if(s){u[r?"moveStart":"moveEnd"]("character",m)}return u}if(a.features.implementsDomRange&&(!a.features.implementsTextRange||!a.config.preferTextRange)){(function(){var s;var r=e.rangeProperties;var l;function v(y){var w=r.length,x;while(w--){x=r[w];y[x]=y.nativeRange[x]}}function u(z,A,C,w,y){var B=(z.startContainer!==A||z.startOffset!=C);var x=(z.endContainer!==w||z.endOffset!=y);if(B||x){z.setEnd(w,y);z.setStart(A,C)}}function n(y){y.nativeRange.detach();y.detached=true;var w=r.length,x;while(w--){x=r[w];y[x]=null}}var m;k=function(w){if(!w){throw new Error("Range must be specified")}this.nativeRange=w;v(this)};e.createPrototypeRange(k,u,n);s=k.prototype;s.selectNode=function(w){this.nativeRange.selectNode(w);v(this)};s.deleteContents=function(){this.nativeRange.deleteContents();v(this)};s.extractContents=function(){var w=this.nativeRange.extractContents();v(this);return w};s.cloneContents=function(){return this.nativeRange.cloneContents()};s.surroundContents=function(w){this.nativeRange.surroundContents(w);v(this)};s.collapse=function(w){this.nativeRange.collapse(w);v(this)};s.cloneRange=function(){return new k(this.nativeRange.cloneRange())};s.refresh=function(){v(this)};s.toString=function(){return this.nativeRange.toString()};var t=document.createTextNode("test");c.getBody(document).appendChild(t);var p=document.createRange();p.setStart(t,0);p.setEnd(t,0);try{p.setStart(t,1);l=true;s.setStart=function(w,x){this.nativeRange.setStart(w,x);v(this)};s.setEnd=function(w,x){this.nativeRange.setEnd(w,x);v(this)};m=function(w){return function(x){this.nativeRange[w](x);v(this)}}}catch(o){l=false;s.setStart=function(x,y){try{this.nativeRange.setStart(x,y)}catch(w){this.nativeRange.setEnd(x,y);this.nativeRange.setStart(x,y)}v(this)};s.setEnd=function(x,y){try{this.nativeRange.setEnd(x,y)}catch(w){this.nativeRange.setStart(x,y);this.nativeRange.setEnd(x,y)}v(this)};m=function(w,x){return function(z){try{this.nativeRange[w](z)}catch(y){this.nativeRange[x](z);this.nativeRange[w](z)}v(this)}}}s.setStartBefore=m("setStartBefore","setEndBefore");s.setStartAfter=m("setStartAfter","setEndAfter");s.setEndBefore=m("setEndBefore","setStartBefore");s.setEndAfter=m("setEndAfter","setStartAfter");p.selectNodeContents(t);if(p.startContainer==t&&p.endContainer==t&&p.startOffset==0&&p.endOffset==t.length){s.selectNodeContents=function(w){this.nativeRange.selectNodeContents(w);v(this)}}else{s.selectNodeContents=function(w){this.setStart(w,0);this.setEnd(w,e.getEndOffset(w))}}p.selectNodeContents(t);p.setEnd(t,3);var q=document.createRange();q.selectNodeContents(t);q.setEnd(t,4);q.setStart(t,2);if(p.compareBoundaryPoints(p.START_TO_END,q)==-1&p.compareBoundaryPoints(p.END_TO_START,q)==1){s.compareBoundaryPoints=function(x,w){w=w.nativeRange||w;if(x==w.START_TO_END){x=w.END_TO_START}else{if(x==w.END_TO_START){x=w.START_TO_END}}return this.nativeRange.compareBoundaryPoints(x,w)}}else{s.compareBoundaryPoints=function(x,w){return this.nativeRange.compareBoundaryPoints(x,w.nativeRange||w)}}if(a.util.isHostMethod(p,"createContextualFragment")){s.createContextualFragment=function(w){return this.nativeRange.createContextualFragment(w)}}c.getBody(document).removeChild(t);p.detach();q.detach()})();a.createNativeRange=function(l){l=l||document;return l.createRange()}}else{if(a.features.implementsTextRange){k=function(l){this.textRange=l;this.refresh()};k.prototype=new e(document);k.prototype.refresh=function(){var n,l;var m=g(this.textRange);if(j(this.textRange)){l=n=f(this.textRange,m,true,true)}else{n=f(this.textRange,m,true,false);l=f(this.textRange,m,false,false)}this.setStart(n.node,n.offset);this.setEnd(l.node,l.offset)};e.copyComparisonConstants(k);var h=(function(){return this})();if(typeof h.Range=="undefined"){h.Range=k}a.createNativeRange=function(l){l=l||document;return l.body.createTextRange()}}}if(a.features.implementsTextRange){k.rangeToTextRange=function(m){if(m.collapsed){var p=b(new d(m.startContainer,m.startOffset),true);return p}else{var n=b(new d(m.startContainer,m.startOffset),true);var l=b(new d(m.endContainer,m.endOffset),false);var o=c.getDocument(m.startContainer).body.createTextRange();o.setEndPoint("StartToStart",n);o.setEndPoint("EndToEnd",l);return o}}}k.prototype.getName=function(){return"WrappedRange"};a.WrappedRange=k;a.createRange=function(l){l=l||document;return new k(a.createNativeRange(l))};a.createRangyRange=function(l){l=l||document;return new e(l)};a.createIframeRange=function(l){return a.createRange(c.getIframeDocument(l))};a.createIframeRangyRange=function(l){return a.createRangyRange(c.getIframeDocument(l))};a.addCreateMissingNativeApiListener(function(m){var l=m.document;if(typeof l.createRange=="undefined"){l.createRange=function(){return a.createRange(this)}}l=m=null})});rangy.createModule("WrappedSelection",function(c,y){c.requireModules(["DomUtil","DomRange","WrappedRange"]);c.config.checkSelectionRanges=true;var f="boolean",T="_rangySelection",j=c.dom,S=c.util,m=c.DomRange,U=c.WrappedRange,k=c.DOMException,l=j.DomPosition,p,G,h="Control";function s(W){return(W||window).getSelection()}function n(W){return(W||window).document.selection}var v=c.util.isHostMethod(window,"getSelection"),u=c.util.isHostObject(document,"selection");var R=u&&(!v||c.config.preferTextRange);if(R){p=n;c.isSelectionValid=function(Y){var W=(Y||window).document,X=W.selection;return(X.type!="None"||j.getDocument(X.createRange().parentElement())==W)}}else{if(v){p=s;c.isSelectionValid=function(){return true}}else{y.fail("Neither document.selection or window.getSelection() detected.")}}c.getNativeSelection=p;var L=p();var K=c.createNativeRange(document);var e=j.getBody(document);var C=S.areHostObjects(L,["anchorNode","focusNode"]&&S.areHostProperties(L,["anchorOffset","focusOffset"]));c.features.selectionHasAnchorAndFocus=C;var D=S.isHostMethod(L,"extend");c.features.selectionHasExtend=D;var E=(typeof L.rangeCount=="number");c.features.selectionHasRangeCount=E;var H=false;var g=true;if(S.areHostMethods(L,["addRange","getRangeAt","removeAllRanges"])&&typeof L.rangeCount=="number"&&c.features.implementsDomRange){(function(){var X=document.createElement("iframe");e.appendChild(X);var Z=j.getIframeDocument(X);Z.open();Z.write("<html><head></head><body>12</body></html>");Z.close();var ac=j.getIframeWindow(X).getSelection();var W=Z.documentElement;var Y=W.lastChild,ad=Y.firstChild;var aa=Z.createRange();aa.setStart(ad,1);aa.collapse(true);ac.addRange(aa);g=(ac.rangeCount==1);ac.removeAllRanges();var ab=aa.cloneRange();aa.setStart(ad,0);ab.setEnd(ad,2);ac.addRange(aa);ac.addRange(ab);H=(ac.rangeCount==2);aa.detach();ab.detach();e.removeChild(X)})()}c.features.selectionSupportsMultipleRanges=H;c.features.collapsedNonEditableSelectionsSupported=g;var t=false,J;if(e&&S.isHostMethod(e,"createControlRange")){J=e.createControlRange();if(S.areHostProperties(J,["item","add"])){t=true}}c.features.implementsControlRange=t;if(C){G=function(W){return W.anchorNode===W.focusNode&&W.anchorOffset===W.focusOffset}}else{G=function(W){return W.rangeCount?W.getRangeAt(W.rangeCount-1).collapsed:false}}function N(aa,Z,X){var W=X?"end":"start",Y=X?"start":"end";aa.anchorNode=Z[W+"Container"];aa.anchorOffset=Z[W+"Offset"];aa.focusNode=Z[Y+"Container"];aa.focusOffset=Z[Y+"Offset"]}function M(X){var W=X.nativeSelection;X.anchorNode=W.anchorNode;X.anchorOffset=W.anchorOffset;X.focusNode=W.focusNode;X.focusOffset=W.focusOffset}function P(W){W.anchorNode=W.focusNode=null;W.anchorOffset=W.focusOffset=0;W.rangeCount=0;W.isCollapsed=true;W._ranges.length=0}function o(X){var W;if(X instanceof m){W=X._selectionNativeRange;if(!W){W=c.createNativeRange(j.getDocument(X.startContainer));W.setEnd(X.endContainer,X.endOffset);W.setStart(X.startContainer,X.startOffset);X._selectionNativeRange=W;X.attachListener("detach",function(){this._selectionNativeRange=null})}}else{if(X instanceof U){W=X.nativeRange}else{if(c.features.implementsDomRange&&(X instanceof j.getWindow(X.startContainer).Range)){W=X}}}return W}function z(Y){if(!Y.length||Y[0].nodeType!=1){return false}for(var W=1,X=Y.length;W<X;++W){if(!j.isAncestorOf(Y[0],Y[W])){return false}}return true}function r(X){var W=X.getNodes();if(!z(W)){throw new Error("getSingleElementFromRange: range "+X.inspect()+" did not consist of a single element")}return W[0]}function x(W){return !!W&&typeof W.text!="undefined"}function Q(X,W){var Y=new U(W);X._ranges=[Y];N(X,Y,false);X.rangeCount=1;X.isCollapsed=Y.collapsed}function O(aa){aa._ranges.length=0;if(aa.docSelection.type=="None"){P(aa)}else{var W=aa.docSelection.createRange();if(x(W)){Q(aa,W)}else{aa.rangeCount=W.length;var Z,X=j.getDocument(W.item(0));for(var Y=0;Y<aa.rangeCount;++Y){Z=c.createRange(X);Z.selectNode(W.item(Y));aa._ranges.push(Z)}aa.isCollapsed=aa.rangeCount==1&&aa._ranges[0].collapsed;N(aa,aa._ranges[aa.rangeCount-1],false)}}}function b(ae,ac){var W=ae.docSelection.createRange();var ad=r(ac);var X=j.getDocument(W.item(0));var ab=j.getBody(X).createControlRange();for(var Z=0,aa=W.length;Z<aa;++Z){ab.add(W.item(Z))}try{ab.add(ad)}catch(Y){throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}ab.select();O(ae)}var q;if(S.isHostMethod(L,"getRangeAt")){q=function(Y,X){try{return Y.getRangeAt(X)}catch(W){return null}}}else{if(C){q=function(Y){var W=j.getDocument(Y.anchorNode);var X=c.createRange(W);X.setStart(Y.anchorNode,Y.anchorOffset);X.setEnd(Y.focusNode,Y.focusOffset);if(X.collapsed!==this.isCollapsed){X.setStart(Y.focusNode,Y.focusOffset);X.setEnd(Y.anchorNode,Y.anchorOffset)}return X}}}function V(X,W,Y){this.nativeSelection=X;this.docSelection=W;this._ranges=[];this.win=Y;this.refresh()}c.getSelection=function(Z){Z=Z||window;var Y=Z[T];var X=p(Z),W=u?n(Z):null;if(Y){Y.nativeSelection=X;Y.docSelection=W;Y.refresh(Z)}else{Y=new V(X,W,Z);Z[T]=Y}return Y};c.getIframeSelection=function(W){return c.getSelection(j.getIframeWindow(W))};var I=V.prototype;function i(ac,ab){var X=j.getDocument(ab[0].startContainer);var W=j.getBody(X).createControlRange();for(var aa=0,Y;aa<rangeCount;++aa){Y=r(ab[aa]);try{W.add(Y)}catch(Z){throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}W.select();O(ac)}if(!R&&C&&S.areHostMethods(L,["removeAllRanges","addRange"])){I.removeAllRanges=function(){this.nativeSelection.removeAllRanges();P(this)};var a=function(Z,Y){var W=m.getRangeDocument(Y);var X=c.createRange(W);X.collapseToPoint(Y.endContainer,Y.endOffset);Z.nativeSelection.addRange(o(X));Z.nativeSelection.extend(Y.startContainer,Y.startOffset);Z.refresh()};if(E){I.addRange=function(Z,W){if(t&&u&&this.docSelection.type==h){b(this,Z)}else{if(W&&D){a(this,Z)}else{var Y;if(H){Y=this.rangeCount}else{this.removeAllRanges();Y=0}this.nativeSelection.addRange(o(Z));this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==Y+1){if(c.config.checkSelectionRanges){var X=q(this.nativeSelection,this.rangeCount-1);if(X&&!m.rangesEqual(X,Z)){Z=new U(X)}}this._ranges[this.rangeCount-1]=Z;N(this,Z,F(this.nativeSelection));this.isCollapsed=G(this)}else{this.refresh()}}}}}else{I.addRange=function(X,W){if(W&&D){a(this,X)}else{this.nativeSelection.addRange(o(X));this.refresh()}}}I.setRanges=function(Y){if(t&&Y.length>1){i(this,Y)}else{this.removeAllRanges();for(var W=0,X=Y.length;W<X;++W){this.addRange(Y[W])}}}}else{if(S.isHostMethod(L,"empty")&&S.isHostMethod(K,"select")&&t&&R){I.removeAllRanges=function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var X;if(this.anchorNode){X=j.getDocument(this.anchorNode)}else{if(this.docSelection.type==h){var W=this.docSelection.createRange();if(W.length){X=j.getDocument(W.item(0)).body.createTextRange()}}}if(X){var Z=X.body.createTextRange();Z.select();this.docSelection.empty()}}}catch(Y){}P(this)};I.addRange=function(W){if(this.docSelection.type==h){b(this,W)}else{U.rangeToTextRange(W).select();this._ranges[0]=W;this.rangeCount=1;this.isCollapsed=this._ranges[0].collapsed;N(this,W,false)}};I.setRanges=function(X){this.removeAllRanges();var W=X.length;if(W>1){i(this,X)}else{if(W){this.addRange(X[0])}}}}else{y.fail("No means of selecting a Range or TextRange was found");return false}}I.getRangeAt=function(W){if(W<0||W>=this.rangeCount){throw new k("INDEX_SIZE_ERR")}else{return this._ranges[W]}};var A;if(R){A=function(X){var W;if(c.isSelectionValid(X.win)){W=X.docSelection.createRange()}else{W=j.getBody(X.win.document).createTextRange();W.collapse(true)}if(X.docSelection.type==h){O(X)}else{if(x(W)){Q(X,W)}else{P(X)}}}}else{if(S.isHostMethod(L,"getRangeAt")&&typeof L.rangeCount=="number"){A=function(Y){if(t&&u&&Y.docSelection.type==h){O(Y)}else{Y._ranges.length=Y.rangeCount=Y.nativeSelection.rangeCount;if(Y.rangeCount){for(var W=0,X=Y.rangeCount;W<X;++W){Y._ranges[W]=new c.WrappedRange(Y.nativeSelection.getRangeAt(W))}N(Y,Y._ranges[Y.rangeCount-1],F(Y.nativeSelection));Y.isCollapsed=G(Y)}else{P(Y)}}}}else{if(C&&typeof L.isCollapsed==f&&typeof K.collapsed==f&&c.features.implementsDomRange){A=function(Y){var X,W=Y.nativeSelection;if(W.anchorNode){X=q(W,0);Y._ranges=[X];Y.rangeCount=1;M(Y);Y.isCollapsed=G(Y)}else{P(Y)}}}else{y.fail("No means of obtaining a Range or TextRange from the user's selection was found");return false}}}I.refresh=function(W){var Y=W?this._ranges.slice(0):null;A(this);if(W){var X=Y.length;if(X!=this._ranges.length){return false}while(X--){if(!m.rangesEqual(Y[X],this._ranges[X])){return false}}return true}};var B=function(ab,Y){var Z=ab.getAllRanges(),aa=false;ab.removeAllRanges();for(var W=0,X=Z.length;W<X;++W){if(aa||Y!==Z[W]){ab.addRange(Z[W])}else{aa=true}}if(!ab.rangeCount){P(ab)}};if(t){I.removeRange=function(ac){if(this.docSelection.type==h){var W=this.docSelection.createRange();var ad=r(ac);var X=j.getDocument(W.item(0));var ab=j.getBody(X).createControlRange();var Y,ae=false;for(var Z=0,aa=W.length;Z<aa;++Z){Y=W.item(Z);if(Y!==ad||ae){ab.add(W.item(Z))}else{ae=true}}ab.select();O(this)}else{B(this,ac)}}}else{I.removeRange=function(W){B(this,W)}}var F;if(!R&&C&&c.features.implementsDomRange){F=function(X){var W=false;if(X.anchorNode){W=(j.comparePoints(X.anchorNode,X.anchorOffset,X.focusNode,X.focusOffset)==1)}return W};I.isBackwards=function(){return F(this)}}else{F=I.isBackwards=function(){return false}}I.toString=function(){var Y=[];for(var W=0,X=this.rangeCount;W<X;++W){Y[W]=""+this._ranges[W]}return Y.join("")};function d(X,W){if(X.anchorNode&&(j.getDocument(X.anchorNode)!==j.getDocument(W))){throw new k("WRONG_DOCUMENT_ERR")}}I.collapse=function(W,X){d(this,W);var Y=c.createRange(j.getDocument(W));Y.collapseToPoint(W,X);this.removeAllRanges();this.addRange(Y);this.isCollapsed=true};I.collapseToStart=function(){if(this.rangeCount){var W=this._ranges[0];this.collapse(W.startContainer,W.startOffset)}else{throw new k("INVALID_STATE_ERR")}};I.collapseToEnd=function(){if(this.rangeCount){var W=this._ranges[this.rangeCount-1];this.collapse(W.endContainer,W.endOffset)}else{throw new k("INVALID_STATE_ERR")}};I.selectAllChildren=function(W){d(this,W);var X=c.createRange(j.getDocument(W));X.selectNodeContents(W);this.removeAllRanges();this.addRange(X)};I.deleteFromDocument=function(){if(t&&u&&this.docSelection.type==h){var W=this.docSelection.createRange();var X;while(W.length){X=W.item(0);W.remove(X);X.parentNode.removeChild(X)}this.refresh()}else{if(this.rangeCount){var aa=this.getAllRanges();this.removeAllRanges();for(var Y=0,Z=aa.length;Y<Z;++Y){aa[Y].deleteContents()}this.addRange(aa[Z-1])}}};I.getAllRanges=function(){return this._ranges.slice(0)};I.setSingleRange=function(W){this.setRanges([W])};I.containsNode=function(Z,W){for(var X=0,Y=this._ranges.length;X<Y;++X){if(this._ranges[X].containsNode(Z,W)){return true}}return false};I.toHtml=function(){var X="";if(this.rangeCount){var W=m.getRangeDocument(this._ranges[0]).createElement("div");for(var Y=0,Z=this._ranges.length;Y<Z;++Y){W.appendChild(this._ranges[Y].cloneContents())}X=W.innerHTML}return X};function w(ac){var ab=[];var W=new l(ac.anchorNode,ac.anchorOffset);var X=new l(ac.focusNode,ac.focusOffset);var aa=(typeof ac.getName=="function")?ac.getName():"Selection";if(typeof ac.rangeCount!="undefined"){for(var Y=0,Z=ac.rangeCount;Y<Z;++Y){ab[Y]=m.inspect(ac.getRangeAt(Y))}}return"["+aa+"(Ranges: "+ab.join(", ")+")(anchor: "+W.inspect()+", focus: "+X.inspect()+"]"}I.getName=function(){return"WrappedSelection"};I.inspect=function(){return w(this)};I.detach=function(){this.win[T]=null;this.win=this.anchorNode=this.focusNode=null};V.inspect=w;c.Selection=V;c.selectionPrototype=I;c.addCreateMissingNativeApiListener(function(W){if(typeof W.getSelection=="undefined"){W.getSelection=function(){return c.getSelection(this)}}W=null})});var Base=function(){};Base.extend=function(a,b){var d=Base.prototype.extend;Base._prototyping=true;var f=new this;d.call(f,a);f.base=function(){};delete Base._prototyping;var c=f.constructor;var e=f.constructor=function(){if(!Base._prototyping){if(this._constructing||this.constructor==e){this._constructing=true;c.apply(this,arguments);delete this._constructing}else{if(arguments[0]!=null){return(arguments[0].extend||d).call(arguments[0],f)}}}};e.ancestor=this;e.extend=this.extend;e.forEach=this.forEach;e.implement=this.implement;e.prototype=f;e.toString=this.toString;e.valueOf=function(g){return(g=="object")?e:c.valueOf()};d.call(e,b);if(typeof e.init=="function"){e.init()}return e};Base.prototype={extend:function(h,j){if(arguments.length>1){var a=this[h];if(a&&(typeof j=="function")&&(!a.valueOf||a.valueOf()!=j.valueOf())&&/\bbase\b/.test(j)){var f=j.valueOf();j=function(){var i=this.base||Base.prototype.base;this.base=a;var k=f.apply(this,arguments);this.base=i;return k};j.valueOf=function(i){return(i=="object")?j:f};j.toString=Base.toString}this[h]=j}else{if(h){var b=Base.prototype.extend;if(!Base._prototyping&&typeof this!="function"){b=this.extend||b}var g={toSource:null};var c=["constructor","toString","valueOf"];var d=Base._prototyping?0:1;while(e=c[d++]){if(h[e]!=g[e]){b.call(this,e,h[e])}}for(var e in h){if(!g[e]){b.call(this,e,h[e])}}}}return this}};Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(d,a,b){for(var c in d){if(this.prototype[c]===undefined){a.call(b,d[c],c,d)}}},implement:function(){for(var a=0;a<arguments.length;a++){if(typeof arguments[a]=="function"){arguments[a](this.prototype)}else{this.prototype.extend(arguments[a])}}return this},toString:function(){return String(this.valueOf())}});wysihtml5.browser=(function(){var h=navigator.userAgent,g=document.createElement("div"),d=h.indexOf("MSIE")!==-1&&h.indexOf("Opera")===-1,c=h.indexOf("Gecko")!==-1&&h.indexOf("KHTML")===-1,f=h.indexOf("AppleWebKit/")!==-1,b=h.indexOf("Chrome/")!==-1,e=h.indexOf("Opera/")!==-1;function a(i){return((/ipad|iphone|ipod/.test(i)&&i.match(/ os (\d+).+? like mac os x/))||[,0])[1]}return{USER_AGENT:h,supported:function(){var m=this.USER_AGENT.toLowerCase(),i="contentEditable" in g,j=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,k=document.querySelector&&document.querySelectorAll,l=(this.isIos()&&a(m)<5)||m.indexOf("opera mobi")!==-1||m.indexOf("hpwos/")!==-1;return i&&j&&k&&!l},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){var i=this.USER_AGENT.toLowerCase();return i.indexOf("webkit")!==-1&&i.indexOf("mobile")!==-1},supportsSandboxedIframes:function(){return d},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return !("querySelector" in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return !c},hasCurrentStyleProperty:function(){return"currentStyle" in g},insertsLineBreaksOnReturn:function(){return c},supportsPlaceholderAttributeOn:function(i){return"placeholder" in i},supportsEvent:function(i){return"on"+i in g||(function(){g.setAttribute("on"+i,"return;");return typeof(g["on"+i])==="function"})()},supportsEventsInIframeCorrectly:function(){return !e},firesOnDropOnlyWhenOnDragOverIsCancelled:function(){return f||c},supportsDataTransfer:function(){try{return f&&(window.Clipboard||window.DataTransfer).prototype.getData}catch(i){return false}},supportsHTML5Tags:function(i){var j=i.createElement("div"),k="<article>foo</article>";j.innerHTML=k;return j.innerHTML.toLowerCase()===k},supportsCommand:(function(){var i={formatBlock:d,insertUnorderedList:d||e||f,insertOrderedList:d||e||f};var j={insertHTML:c};return function(l,k){var o=i[k];if(!o){try{return l.queryCommandSupported(k)}catch(m){}try{return l.queryCommandEnabled(k)}catch(n){return !!j[k]}}return false}})(),doesAutoLinkingInContentEditable:function(){return d},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return c||e||f},supportsGetAttributeCorrectly:function(){var i=document.createElement("td");return i.getAttribute("rowspan")!="1"},canSelectImagesInContentEditable:function(){return c||d||e},clearsListsInContentEditableCorrectly:function(){return c||d||f},autoScrollsToCaret:function(){return !f},autoClosesUnclosedTags:function(){var i=g.cloneNode(false),k,j;i.innerHTML="<p><div></div>";j=i.innerHTML.toLowerCase();k=j==="<p></p><div></div>"||j==="<p><div></div></p>";this.autoClosesUnclosedTags=function(){return k};return k},supportsNativeGetElementsByClassName:function(){return String(document.getElementsByClassName).indexOf("[native code]")!==-1},supportsSelectionModify:function(){return"getSelection" in window&&"modify" in window.getSelection()},supportsClassList:function(){return"classList" in g},needsSpaceAfterLineBreak:function(){return e},supportsSpeechApiOn:function(j){var i=h.match(/Chrome\/(\d+)/)||[,0];return i[1]>=11&&("onwebkitspeechchange" in j||"speech" in j)},crashesWhenDefineProperty:function(i){return d&&(i==="XMLHttpRequest"||i==="XDomainRequest")},doesAsyncFocus:function(){return d},hasProblemsSettingCaretAfterImg:function(){return d},hasUndoInContextMenu:function(){return c||b||e}}})();wysihtml5.lang.array=function(a){return{contains:function(d){if(a.indexOf){return a.indexOf(d)!==-1}else{for(var b=0,c=a.length;b<c;b++){if(a[b]===d){return true}}return false}},without:function(b){b=wysihtml5.lang.array(b);var e=[],c=0,d=a.length;for(;c<d;c++){if(!b.contains(a[c])){e.push(a[c])}}return e},get:function(){var b=0,c=a.length,d=[];for(;b<c;b++){d.push(a[b])}return d}}};wysihtml5.lang.Dispatcher=Base.extend({observe:function(a,b){this.events=this.events||{};this.events[a]=this.events[a]||[];this.events[a].push(b);return this},on:function(){return this.observe.apply(this,wysihtml5.lang.array(arguments).get())},fire:function(a,d){this.events=this.events||{};var b=this.events[a]||[],c=0;for(;c<b.length;c++){b[c].call(this,d)}return this},stopObserving:function(a,b){this.events=this.events||{};var d=0,c,e;if(a){c=this.events[a]||[],e=[];for(;d<c.length;d++){if(c[d]!==b&&b){e.push(c[d])}}this.events[a]=e}else{this.events={}}return this}});wysihtml5.lang.object=function(a){return{merge:function(c){for(var b in c){a[b]=c[b]}return this},get:function(){return a},clone:function(){var c={},b;for(b in a){c[b]=a[b]}return c},isArray:function(){return Object.prototype.toString.call(a)==="[object Array]"}}};(function(){var b=/^\s+/,a=/\s+$/;wysihtml5.lang.string=function(c){c=String(c);return{trim:function(){return c.replace(b,"").replace(a,"")},interpolate:function(e){for(var d in e){c=this.replace("#{"+d+"}").by(e[d])}return c},replace:function(d){return{by:function(e){return c.split(d).join(e)}}}}}})();(function(l){var h=l.lang.array(["CODE","PRE","A","SCRIPT","HEAD","TITLE","STYLE"]),k=/((https?:\/\/|www\.)[^\s<]{3,})/gi,j=/([^\w\/\-](,?))$/i,i=100,g={")":"(","]":"[","}":"{"};function f(m){if(c(m)){return m}if(m===m.ownerDocument.documentElement){m=m.ownerDocument.body}return d(m)}function a(m){return m.replace(k,function(o,s){var q=(s.match(j)||[])[1]||"",p=g[q];s=s.replace(j,"");if(s.split(p).length>s.split(q).length){s=s+q;q=""}var r=s,n=s;if(s.length>i){n=n.substr(0,i)+"..."}if(r.substr(0,4)==="www."){r="http://"+r}return'<a href="'+r+'">'+n+"</a>"+q})}function b(m){var n=m._wysihtml5_tempElement;if(!n){n=m._wysihtml5_tempElement=m.createElement("div")}return n}function e(o){var m=o.parentNode,n=b(m.ownerDocument);n.innerHTML="<span></span>"+a(o.data);n.removeChild(n.firstChild);while(n.firstChild){m.insertBefore(n.firstChild,o)}m.removeChild(o)}function c(m){var n;while(m.parentNode){m=m.parentNode;n=m.nodeName;if(h.contains(n)){return true}else{if(n==="body"){return false}}}return false}function d(o){if(h.contains(o.nodeName)){return}if(o.nodeType===l.TEXT_NODE&&o.data.match(k)){e(o);return}var m=l.lang.array(o.childNodes).get(),n=m.length,p=0;for(;p<n;p++){d(m[p])}return o}l.dom.autoLink=f;l.dom.autoLink.URL_REG_EXP=k})(wysihtml5);(function(c){var b=c.browser.supportsClassList(),a=c.dom;a.addClass=function(e,d){if(b){return e.classList.add(d)}if(a.hasClass(e,d)){return}e.className+=" "+d};a.removeClass=function(e,d){if(b){return e.classList.remove(d)}e.className=e.className.replace(new RegExp("(^|\\s+)"+d+"(\\s+|$)")," ")};a.hasClass=function(e,d){if(b){return e.classList.contains(d)}var f=e.className;return(f.length>0&&(f==d||new RegExp("(^|\\s)"+d+"(\\s|$)").test(f)))}})(wysihtml5);wysihtml5.dom.contains=(function(){var a=document.documentElement;if(a.contains){return function(b,c){if(c.nodeType!==wysihtml5.ELEMENT_NODE){c=c.parentNode}return b!==c&&b.contains(c)}}else{if(a.compareDocumentPosition){return function(b,c){return !!(b.compareDocumentPosition(c)&16)}}}})();wysihtml5.dom.convertToList=(function(){function b(d,e){var f=d.createElement("li");e.appendChild(f);return f}function a(d,e){return d.createElement(e)}function c(j,r){if(j.nodeName==="UL"||j.nodeName==="OL"||j.nodeName==="MENU"){return j}var h=j.ownerDocument,q=a(h,r),o=j.querySelectorAll("br"),p=o.length,e,f,d,n,s,l,m,g,k;for(k=0;k<p;k++){n=o[k];while((s=n.parentNode)&&s!==j&&s.lastChild===n){if(wysihtml5.dom.getStyle("display").from(s)==="block"){s.removeChild(n);break}wysihtml5.dom.insert(n).after(n.parentNode)}}e=wysihtml5.lang.array(j.childNodes).get();f=e.length;for(k=0;k<f;k++){g=g||b(h,q);d=e[k];l=wysihtml5.dom.getStyle("display").from(d)==="block";m=d.nodeName==="BR";if(l){g=g.firstChild?b(h,q):g;g.appendChild(d);g=null;continue}if(m){g=g.firstChild?null:g;continue}g.appendChild(d)}j.parentNode.replaceChild(q,j);return q}return c})();wysihtml5.dom.copyAttributes=function(a){return{from:function(b){return{to:function(d){var c,e=0,f=a.length;for(;e<f;e++){c=a[e];if(typeof(b[c])!=="undefined"&&b[c]!==""){d[c]=b[c]}}return{andTo:arguments.callee}}}}}};(function(b){var a=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"];var d=function(e){if(c(e)){return parseInt(b.getStyle("width").from(e),10)<e.offsetWidth}return false};var c=function(e){var f=0,g=a.length;for(;f<g;f++){if(b.getStyle(a[f]).from(e)==="border-box"){return a[f]}}};b.copyStyles=function(e){return{from:function(g){if(d(g)){e=wysihtml5.lang.array(e).without(a)}var f="",j=e.length,h=0,k;for(;h<j;h++){k=e[h];f+=k+":"+b.getStyle(k).from(g)+";"}return{to:function(i){b.setStyles(f).on(i);return{andTo:arguments.callee}}}}}}})(wysihtml5.dom);(function(a){a.dom.delegate=function(b,e,c,d){return a.dom.observe(b,c,function(f){var h=f.target,g=a.lang.array(b.querySelectorAll(e));while(h&&h!==b){if(g.contains(h)){d.call(h,f);break}h=h.parentNode}})}})(wysihtml5);wysihtml5.dom.getAsDom=(function(){var b=function(g,d){var h=d.createElement("div");h.style.display="none";d.body.appendChild(h);try{h.innerHTML=g}catch(f){}d.body.removeChild(h);return h};var a=function(d){if(d._wysihtml5_supportsHTML5Tags){return}for(var e=0,f=c.length;e<f;e++){d.createElement(c[e])}d._wysihtml5_supportsHTML5Tags=true};var c=["abbr","article","aside","audio","bdi","canvas","command","datalist","details","figcaption","figure","footer","header","hgroup","keygen","mark","meter","nav","output","progress","rp","rt","ruby","svg","section","source","summary","time","track","video","wbr"];return function(e,d){d=d||document;var f;if(typeof(e)==="object"&&e.nodeType){f=d.createElement("div");f.appendChild(e)}else{if(wysihtml5.browser.supportsHTML5Tags(d)){f=d.createElement("div");f.innerHTML=e}else{a(d);f=b(e,d)}}return f}})();wysihtml5.dom.getParentElement=(function(){function e(g,f){if(!f||!f.length){return true}if(typeof(f)==="string"){return g===f}else{return wysihtml5.lang.array(f).contains(g)}}function d(f){return f.nodeType===wysihtml5.ELEMENT_NODE}function c(i,f,h){var g=(i.className||"").match(h)||[];if(!f){return !!g.length}return g[g.length-1]===f}function a(g,h,f){while(f--&&g&&g.nodeName!=="BODY"){if(e(g.nodeName,h)){return g}g=g.parentNode}return null}function b(i,j,f,g,h){while(h--&&i&&i.nodeName!=="BODY"){if(d(i)&&e(i.nodeName,j)&&c(i,f,g)){return i}i=i.parentNode}return null}return function(h,g,f){f=f||50;if(g.className||g.classRegExp){return b(h,g.nodeName,g.className,g.classRegExp,f)}else{return a(h,g.nodeName,f)}}})();wysihtml5.dom.getStyle=(function(){var c={"float":("styleFloat" in document.createElement("div").style)?"styleFloat":"cssFloat"},b=/\-[a-z]/g;function a(d){return d.replace(b,function(e){return e.charAt(1).toUpperCase()})}return function(d){return{from:function(j){if(j.nodeType!==wysihtml5.ELEMENT_NODE){return}var h=j.ownerDocument,f=c[d]||a(d),n=j.style,g=j.currentStyle,o=n[f];if(o){return o}if(g){try{return g[f]}catch(i){}}var p=h.defaultView||h.parentWindow,k=(d==="height"||d==="width")&&j.nodeName==="TEXTAREA",l,m;if(p.getComputedStyle){if(k){l=n.overflow;n.overflow="hidden"}m=p.getComputedStyle(j,null).getPropertyValue(d);if(k){n.overflow=l||""}return m}}}}})();wysihtml5.dom.hasElementWithTagName=(function(){var c={},b=1;function a(d){return d._wysihtml5_identifier||(d._wysihtml5_identifier=b++)}return function(e,g){var f=a(e)+":"+g,d=c[f];if(!d){d=c[f]=e.getElementsByTagName(g)}return d.length>0}})();(function(d){var c={},b=1;function a(e){return e._wysihtml5_identifier||(e._wysihtml5_identifier=b++)}d.dom.hasElementWithClassName=function(g,f){if(!d.browser.supportsNativeGetElementsByClassName()){return !!g.querySelector("."+f)}var h=a(g)+":"+f,e=c[h];if(!e){e=c[h]=g.getElementsByClassName(f)}return e.length>0}})(wysihtml5);wysihtml5.dom.insert=function(a){return{after:function(b){b.parentNode.insertBefore(a,b.nextSibling)},before:function(b){b.parentNode.insertBefore(a,b)},into:function(b){b.appendChild(a)}}};wysihtml5.dom.insertCSS=function(a){a=a.join("\n");return{into:function(b){var c=b.head||b.getElementsByTagName("head")[0],d=b.createElement("style");d.type="text/css";if(d.styleSheet){d.styleSheet.cssText=a}else{d.appendChild(b.createTextNode(a))}if(c){c.appendChild(d)}}}};wysihtml5.dom.observe=function(a,c,d){c=typeof(c)==="string"?[c]:c;var e,b,f=0,g=c.length;for(;f<g;f++){b=c[f];if(a.addEventListener){a.addEventListener(b,d,false)}else{e=function(h){if(!("target" in h)){h.target=h.srcElement}h.preventDefault=h.preventDefault||function(){this.returnValue=false};h.stopPropagation=h.stopPropagation||function(){this.cancelBubble=true};d.call(a,h)};a.attachEvent("on"+b,e)}}return{stop:function(){var h,j=0,k=c.length;for(;j<k;j++){h=c[j];if(a.removeEventListener){a.removeEventListener(h,d,false)}else{a.detachEvent("on"+h,e)}}}}};wysihtml5.dom.parse=(function(){var m={"1":d,"3":e},j="span",o=/\s+/,k={tags:{},classes:{}},i={};function n(s,x,q,p){wysihtml5.lang.object(i).merge(k).merge(x).get();q=q||s.ownerDocument||document;var u=q.createDocumentFragment(),v=typeof(s)==="string",r,w,t;if(v){r=wysihtml5.dom.getAsDom(s,q)}else{r=s}while(r.firstChild){t=r.firstChild;r.removeChild(t);w=a(t,p);if(w){u.appendChild(w)}}r.innerHTML="";r.appendChild(u);return v?wysihtml5.quirks.getCorrectInnerHTML(r):r}function a(v,p){var w=v.nodeType,t=v.childNodes,u=t.length,s,r=m[w],q=0;s=r&&r(v);if(!s){return null}for(q=0;q<u;q++){newChild=a(t[q],p);if(newChild){s.appendChild(newChild)}}if(p&&s.childNodes.length<=1&&s.nodeName.toLowerCase()===j&&!s.attributes.length){return s.firstChild}return s}function d(s){var t,q,p,v=i.tags,r=s.nodeName.toLowerCase(),u=s.scopeName;if(s._wysihtml5){return null}s._wysihtml5=1;if(s.className==="wysihtml5-temp"){return null}if(u&&u!="HTML"){r=u+":"+r}if("outerHTML" in s){if(!wysihtml5.browser.autoClosesUnclosedTags()&&s.nodeName==="P"&&s.outerHTML.slice(-4).toLowerCase()!=="</p>"){r="div"}}if(r in v){t=v[r];if(!t||t.remove){return null}t=typeof(t)==="string"?{rename_tag:t}:t}else{if(s.firstChild){t={rename_tag:j}}else{return null}}q=s.ownerDocument.createElement(t.rename_tag||r);c(s,q,t);s=null;return q}function c(H,E,I){var s={},K=I.set_class,p=I.add_class,J=I.set_attributes,t=I.check_attributes,q=i.classes,y=0,u=[],C=[],F=[],G=[],v,D,w,B,r,A,z;if(J){s=wysihtml5.lang.object(J).clone()}if(t){for(r in t){z=h[t[r]];if(!z){continue}A=z(b(H,r));if(typeof(A)==="string"){s[r]=A}}}if(K){u.push(K)}if(p){for(r in p){z=g[p[r]];if(!z){continue}B=z(b(H,r));if(typeof(B)==="string"){u.push(B)}}}q["_wysihtml5-temp-placeholder"]=1;G=H.getAttribute("class");if(G){u=u.concat(G.split(o))}v=u.length;for(;y<v;y++){w=u[y];if(q[w]){C.push(w)}}D=C.length;while(D--){w=C[D];if(!wysihtml5.lang.array(F).contains(w)){F.unshift(w)}}if(F.length){s["class"]=F.join(" ")}for(r in s){try{E.setAttribute(r,s[r])}catch(x){}}if(s.src){if(typeof(s.width)!=="undefined"){E.setAttribute("width",s.width)}if(typeof(s.height)!=="undefined"){E.setAttribute("height",s.height)}}}var l=!wysihtml5.browser.supportsGetAttributeCorrectly();function b(r,p){p=p.toLowerCase();var s=r.nodeName;if(s=="IMG"&&p=="src"&&f(r)===true){return r.src}else{if(l&&"outerHTML" in r){var t=r.outerHTML.toLowerCase(),q=t.indexOf(" "+p+"=")!=-1;return q?r.getAttribute(p):null}else{return r.getAttribute(p)}}}function f(q){try{return q.complete&&!q.mozMatchesSelector(":-moz-broken")}catch(p){if(q.complete&&q.readyState==="complete"){return true}}}function e(p){return p.ownerDocument.createTextNode(p.data)}var h={url:(function(){var p=/^https?:\/\//i;return function(q){if(!q||!q.match(p)){return null}return q.replace(p,function(r){return r.toLowerCase()})}})(),alt:(function(){var p=/[^ a-z0-9_\-]/gi;return function(q){if(!q){return""}return q.replace(p,"")}})(),numbers:(function(){var p=/\D/g;return function(q){q=(q||"").replace(p,"");return q||null}})()};var g={align_img:(function(){var p={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(q){return p[String(q).toLowerCase()]}})(),align_text:(function(){var p={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(q){return p[String(q).toLowerCase()]}})(),clear_br:(function(){var p={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(q){return p[String(q).toLowerCase()]}})(),size_font:(function(){var p={"1":"wysiwyg-font-size-xx-small","2":"wysiwyg-font-size-small","3":"wysiwyg-font-size-medium","4":"wysiwyg-font-size-large","5":"wysiwyg-font-size-x-large","6":"wysiwyg-font-size-xx-large","7":"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(q){return p[String(q).charAt(0)]}})()};return n})();wysihtml5.dom.removeEmptyTextNodes=function(e){var a,b=wysihtml5.lang.array(e.childNodes).get(),c=b.length,d=0;for(;d<c;d++){a=b[d];if(a.nodeType===wysihtml5.TEXT_NODE&&a.data===""){a.parentNode.removeChild(a)}}};wysihtml5.dom.renameElement=function(a,d){var c=a.ownerDocument.createElement(d),b;while(b=a.firstChild){c.appendChild(b)}wysihtml5.dom.copyAttributes(["align","className"]).from(a).to(c);a.parentNode.replaceChild(c,a);return c};wysihtml5.dom.replaceWithChildNodes=function(b){if(!b.parentNode){return}if(!b.firstChild){b.parentNode.removeChild(b);return}var a=b.ownerDocument.createDocumentFragment();while(b.firstChild){a.appendChild(b.firstChild)}b.parentNode.replaceChild(a,b);b=a=null};(function(d){function b(f){return d.getStyle("display").from(f)==="block"}function c(f){return f.nodeName==="BR"}function a(f){var g=f.ownerDocument.createElement("br");f.appendChild(g)}function e(k){if(k.nodeName!=="MENU"&&k.nodeName!=="UL"&&k.nodeName!=="OL"){return}var f=k.ownerDocument,h=f.createDocumentFragment(),m=k.previousElementSibling||k.previousSibling,g,j,i,n,l;if(m&&!b(m)){a(h)}while(l=k.firstChild){j=l.lastChild;while(g=l.firstChild){i=g===j;n=i&&!b(g)&&!c(g);h.appendChild(g);if(n){a(h)}}l.parentNode.removeChild(l)}k.parentNode.replaceChild(h,k)}d.resolveList=e})(wysihtml5.dom);(function(e){var a=document,c=["parent","top","opener","frameElement","frames","localStorage","globalStorage","sessionStorage","indexedDB"],d=["open","close","openDialog","showModalDialog","alert","confirm","prompt","openDatabase","postMessage","XMLHttpRequest","XDomainRequest"],b=["referrer","write","open","close"];e.dom.Sandbox=Base.extend({constructor:function(g,f){this.callback=g||e.EMPTY_FUNCTION;this.config=e.lang.object({}).merge(f).get();this.iframe=this._createIframe()},insertInto:function(f){if(typeof(f)==="string"){f=a.getElementById(f)}f.appendChild(this.iframe)},getIframe:function(){return this.iframe},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var f=this.getIframe();f.parentNode.removeChild(f)},_readyError:function(){throw new Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function(){var g=this,f=a.createElement("iframe");f.className="wysihtml5-sandbox";e.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(f);if(e.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()){f.src="javascript:'<html></html>'"}f.onload=function(){f.onreadystatechange=f.onload=null;g._onLoadIframe(f)};f.onreadystatechange=function(){if(/loaded|complete/.test(f.readyState)){f.onreadystatechange=f.onload=null;g._onLoadIframe(f)}};return f},_onLoadIframe:function(h){if(!e.dom.contains(a.documentElement,h)){return}var n=this,k=h.contentWindow,j=h.contentWindow.document,f=a.characterSet||a.charset||"utf-8",m=this._getHtml({charset:f,stylesheets:this.config.stylesheets});j.open("text/html","replace");j.write(m);j.close();this.getWindow=function(){return h.contentWindow};this.getDocument=function(){return h.contentWindow.document};k.onerror=function(i,o,p){throw new Error("wysihtml5.Sandbox: "+i,o,p)};if(!e.browser.supportsSandboxedIframes()){var g,l;for(g=0,l=c.length;g<l;g++){this._unset(k,c[g])}for(g=0,l=d.length;g<l;g++){this._unset(k,d[g],e.EMPTY_FUNCTION)}for(g=0,l=b.length;g<l;g++){this._unset(j,b[g])}this._unset(j,"cookie","",true)}this.loaded=true;setTimeout(function(){n.callback(n)},0)},_getHtml:function(k){var j=k.stylesheets,f="",g=0,h;j=typeof(j)==="string"?[j]:j;if(j){h=j.length;for(;g<h;g++){f+='<link rel="stylesheet" href="'+j[g]+'">'}}k.stylesheets=f;return e.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(k)},_unset:function(h,i,k,j){try{h[i]=k}catch(g){}try{h.__defineGetter__(i,function(){return k})}catch(g){}if(j){try{h.__defineSetter__(i,function(){})}catch(g){}}if(!e.browser.crashesWhenDefineProperty(i)){try{var f={get:function(){return k}};if(j){f.set=function(){}}Object.defineProperty(h,i,f)}catch(g){}}}})})(wysihtml5);(function(){var a={className:"class"};wysihtml5.dom.setAttributes=function(b){return{on:function(c){for(var d in b){c.setAttribute(a[d]||d,b[d])}}}}})();wysihtml5.dom.setStyles=function(a){return{on:function(b){var d=b.style;if(typeof(a)==="string"){d.cssText+=";"+a;return}for(var c in a){if(c==="float"){d.cssFloat=a[c];d.styleFloat=a[c]}else{d[c]=a[c]}}}}};(function(a){a.simulatePlaceholder=function(c,g,d){var b="placeholder",f=function(){if(g.hasPlaceholderSet()){g.clear()}a.removeClass(g.element,b)},e=function(){if(g.isEmpty()){g.setValue(d);a.addClass(g.element,b)}};c.observe("set_placeholder",e).observe("unset_placeholder",f).observe("focus:composer",f).observe("paste:composer",f).observe("blur:composer",e);e()}})(wysihtml5.dom);(function(b){var a=document.documentElement;if("textContent" in a){b.setTextContent=function(c,d){c.textContent=d};b.getTextContent=function(c){return c.textContent}}else{if("innerText" in a){b.setTextContent=function(c,d){c.innerText=d};b.getTextContent=function(c){return c.innerText}}else{b.setTextContent=function(c,d){c.nodeValue=d};b.getTextContent=function(c){return c.nodeValue}}}})(wysihtml5.dom);wysihtml5.quirks.cleanPastedHTML=(function(){var b={"a u":wysihtml5.dom.replaceWithChildNodes};function a(e,n,c){n=n||b;c=c||e.ownerDocument||document;var d,g=typeof(e)==="string",m,k,l,f,h=0;if(g){d=wysihtml5.dom.getAsDom(e,c)}else{d=e}for(f in n){k=d.querySelectorAll(f);m=n[f];l=k.length;for(;h<l;h++){m(k[h])}}k=e=n=null;return g?d.innerHTML:d}return a})();(function(b){var a=b.dom;b.quirks.ensureProperClearing=(function(){var c=function(e){var d=this;setTimeout(function(){var f=d.innerHTML.toLowerCase();if(f=="<p>&nbsp;</p>"||f=="<p>&nbsp;</p><p>&nbsp;</p>"){d.innerHTML=""}},0)};return function(d){a.observe(d.element,["cut","keydown"],c)}})();b.quirks.ensureProperClearingOfLists=(function(){var d=["OL","UL","MENU"];var c=function(f,e){if(!e.firstChild||!b.lang.array(d).contains(e.firstChild.nodeName)){return}var h=a.getParentElement(f,{nodeName:d});if(!h){return}var i=h==e.firstChild;if(!i){return}var g=h.childNodes.length<=1;if(!g){return}var j=h.firstChild?h.firstChild.innerHTML==="":true;if(!j){return}h.parentNode.removeChild(h)};return function(e){a.observe(e.element,"keydown",function(g){if(g.keyCode!==b.BACKSPACE_KEY){return}var f=e.selection.getSelectedNode();c(f,e.element)})}})()})(wysihtml5);(function(b){var a="%7E";b.quirks.getCorrectInnerHTML=function(c){var f=c.innerHTML;if(f.indexOf(a)===-1){return f}var d=c.querySelectorAll("[href*='~'], [src*='~']"),h,j,g,e;for(e=0,g=d.length;e<g;e++){h=d[e].href||d[e].src;j=b.lang.string(h).replace("~").by(a);f=b.lang.string(f).replace(j).by(h)}return f}})(wysihtml5);(function(d){var a=d.dom,c=["LI","P","H1","H2","H3","H4","H5","H6"],b=["UL","OL","MENU"];d.quirks.insertLineBreakOnReturn=function(e){function g(j){var i=a.getParentElement(j,{nodeName:["P","DIV"]},2);if(!i){return}var h=document.createTextNode(d.INVISIBLE_SPACE);a.insert(h).before(i);a.replaceWithChildNodes(i);e.selection.selectNode(h)}function f(j){var k=j.keyCode;if(j.shiftKey||(k!==d.ENTER_KEY&&k!==d.BACKSPACE_KEY)){return}var i=j.target,l=e.selection.getSelectedNode(),h=a.getParentElement(l,{nodeName:c},4);if(h){if(h.nodeName==="LI"&&(k===d.ENTER_KEY||k===d.BACKSPACE_KEY)){setTimeout(function(){var o=e.selection.getSelectedNode(),n,m;if(!o){return}n=a.getParentElement(o,{nodeName:b},2);if(n){return}g(o)},0)}else{if(h.nodeName.match(/H[1-6]/)&&k===d.ENTER_KEY){setTimeout(function(){g(e.selection.getSelectedNode())},0)}}return}if(k===d.ENTER_KEY&&!d.browser.insertsLineBreaksOnReturn()){e.commands.exec("insertLineBreak");j.preventDefault()}}a.observe(e.element.ownerDocument,"keydown",f)}})(wysihtml5);(function(b){var a="wysihtml5-quirks-redraw";b.quirks.redraw=function(f){b.dom.addClass(f,a);b.dom.removeClass(f,a);try{var c=f.ownerDocument;c.execCommand("italic",false,null);c.execCommand("italic",false,null)}catch(d){}}})(wysihtml5);(function(c){var b=c.dom;function a(d){var e=0;if(d.parentNode){do{e+=d.offsetTop||0;d=d.offsetParent}while(d)}return e}c.Selection=Base.extend({constructor:function(d){window.rangy.init();this.editor=d;this.composer=d.composer;this.doc=this.composer.doc},getBookmark:function(){var d=this.getRange();return d&&d.cloneRange()},setBookmark:function(d){if(!d){return}this.setSelection(d)},setBefore:function(d){var e=rangy.createRange(this.doc);e.setStartBefore(d);e.setEndBefore(d);return this.setSelection(e)},setAfter:function(d){var e=rangy.createRange(this.doc);e.setStartAfter(d);e.setEndAfter(d);return this.setSelection(e)},selectNode:function(l){var m=rangy.createRange(this.doc),j=l.nodeType===c.ELEMENT_NODE,d="canHaveHTML" in l?l.canHaveHTML:(l.nodeName!=="IMG"),f=j?l.innerHTML:l.data,k=(f===""||f===c.INVISIBLE_SPACE),g=b.getStyle("display").from(l),i=(g==="block"||g==="list-item");if(k&&j&&d){try{l.innerHTML=c.INVISIBLE_SPACE}catch(h){}}if(d){m.selectNodeContents(l)}else{m.selectNode(l)}if(d&&k&&j){m.collapse(i)}else{if(d&&k){m.setStartAfter(l);m.setEndAfter(l)}}this.setSelection(m)},getSelectedNode:function(d){var f,e;if(d&&this.doc.selection&&this.doc.selection.type==="Control"){e=this.doc.selection.createRange();if(e&&e.length){return e.item(0)}}f=this.getSelection(this.doc);if(f.focusNode===f.anchorNode){return f.focusNode}else{e=this.getRange(this.doc);return e?e.commonAncestorContainer:this.doc.body}},executeAndRestore:function(h,o){var d=this.doc.body,l=o&&d.scrollTop,k=o&&d.scrollLeft,e="_wysihtml5-temp-placeholder",m='<span class="'+e+'">'+c.INVISIBLE_SPACE+"</span>",n=this.getRange(this.doc),i;if(!n){h(d,d);return}var j=n.createContextualFragment(m);n.insertNode(j);try{h(n.startContainer,n.endContainer)}catch(f){setTimeout(function(){throw f},0)}caretPlaceholder=this.doc.querySelector("."+e);if(caretPlaceholder){i=rangy.createRange(this.doc);i.selectNode(caretPlaceholder);i.deleteContents();this.setSelection(i)}else{d.focus()}if(o){d.scrollTop=l;d.scrollLeft=k}try{caretPlaceholder.parentNode.removeChild(caretPlaceholder)}catch(g){}},executeAndRestoreSimple:function(l){var n=this.getRange(),d=this.doc.body,m,j,k,p,o;if(!n){l(d,d);return}p=n.getNodes([3]);j=p[0]||n.startContainer;k=p[p.length-1]||n.endContainer;o={collapsed:n.collapsed,startContainer:j,startOffset:j===n.startContainer?n.startOffset:0,endContainer:k,endOffset:k===n.endContainer?n.endOffset:k.length};try{l(n.startContainer,n.endContainer)}catch(f){setTimeout(function(){throw f},0)}m=rangy.createRange(this.doc);try{m.setStart(o.startContainer,o.startOffset)}catch(g){}try{m.setEnd(o.endContainer,o.endOffset)}catch(h){}try{this.setSelection(m)}catch(i){}},insertHTML:function(d){var g=rangy.createRange(this.doc),f=g.createContextualFragment(d),e=f.lastChild;this.insertNode(f);if(e){this.setAfter(e)}},insertNode:function(d){var e=this.getRange();if(e){e.insertNode(d)}},surround:function(f){var g=this.getRange();if(!g){return}try{g.surroundContents(f);this.selectNode(f)}catch(d){f.appendChild(g.extractContents());g.insertNode(f)}},scrollIntoView:function(){var d=this.doc,e=d.documentElement.scrollHeight>d.documentElement.offsetHeight,g=d._wysihtml5ScrollIntoViewElement=d._wysihtml5ScrollIntoViewElement||(function(){var h=d.createElement("span");h.innerHTML=c.INVISIBLE_SPACE;return h})(),f;if(e){this.insertNode(g);f=a(g);g.parentNode.removeChild(g);if(f>d.body.scrollTop){d.body.scrollTop=f}}},selectLine:function(){if(c.browser.supportsSelectionModify()){this._selectLine_W3C()}else{if(this.doc.selection){this._selectLine_MSIE()}}},_selectLine_W3C:function(){var e=this.doc.defaultView,d=e.getSelection();d.modify("extend","left","lineboundary");d.modify("extend","right","lineboundary")},_selectLine_MSIE:function(){var k=this.doc.selection.createRange(),o=k.boundingTop,n=k.boundingHeight,p=this.doc.body.scrollWidth,l,m,h,f,g;if(!k.moveToPoint){return}if(o===0){h=this.doc.createElement("span");this.insertNode(h);o=h.offsetTop;h.parentNode.removeChild(h)}o+=1;for(f=-10;f<p;f+=2){try{k.moveToPoint(f,o);break}catch(d){}}l=o;m=this.doc.selection.createRange();for(g=p;g>=0;g--){try{m.moveToPoint(g,l);break}catch(e){}}k.setEndPoint("EndToEnd",m);k.select()},getText:function(){var d=this.getSelection();return d?d.toString():""},getNodes:function(e,d){var f=this.getRange();if(f){return f.getNodes([e],d)}else{return[]}},getRange:function(){var d=this.getSelection();return d&&d.rangeCount&&d.getRangeAt(0)},getSelection:function(){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow)},setSelection:function(d){var f=this.doc.defaultView||this.doc.parentWindow,e=rangy.getSelection(f);return e.setSingleRange(d)}})})(wysihtml5);(function(n,i){var b="span";var j=/\s+/g;function d(p,o,r){if(!p.className){return false}var q=p.className.match(r)||[];return q[q.length-1]===o}function a(p,o,q){if(p.className){k(p,q);p.className+=" "+o}else{p.className=o}}function k(o,p){if(o.className){o.className=o.className.replace(p,"")}}function e(o,p){return o.className.replace(j," ")==p.className.replace(j," ")}function l(o){var p=o.parentNode;while(o.firstChild){p.insertBefore(o.firstChild,o)}p.removeChild(o)}function c(q,r){if(q.attributes.length!=r.attributes.length){return false}for(var s=0,t=q.attributes.length,o,p,u;s<t;++s){o=q.attributes[s];u=o.name;if(u!="class"){p=r.attributes.getNamedItem(u);if(o.specified!=p.specified){return false}if(o.specified&&o.nodeValue!==p.nodeValue){return false}}}return true}function g(o,p){if(i.dom.isCharacterDataNode(o)){if(p==0){return !!o.previousSibling}else{if(p==o.length){return !!o.nextSibling}else{return true}}}return p>0&&p<o.childNodes.length}function m(s,p,q){var r;if(i.dom.isCharacterDataNode(p)){if(q==0){q=i.dom.getNodeIndex(p);p=p.parentNode}else{if(q==p.length){q=i.dom.getNodeIndex(p)+1;p=p.parentNode}else{r=i.dom.splitDataNode(p,q)}}}if(!r){r=p.cloneNode(false);if(r.id){r.removeAttribute("id")}var o;while((o=p.childNodes[q])){r.appendChild(o)}i.dom.insertAfter(r,p)}return(p==s)?r:m(s,r.parentNode,i.dom.getNodeIndex(r))}function h(o){this.isElementMerge=(o.nodeType==n.ELEMENT_NODE);this.firstTextNode=this.isElementMerge?o.lastChild:o;this.textNodes=[this.firstTextNode]}h.prototype={doMerge:function(){var s=[],t,q,r;for(var o=0,p=this.textNodes.length;o<p;++o){t=this.textNodes[o];q=t.parentNode;s[o]=t.data;if(o){q.removeChild(t);if(!q.hasChildNodes()){q.parentNode.removeChild(q)}}}this.firstTextNode.data=r=s.join("");return r},getLength:function(){var o=this.textNodes.length,p=0;while(o--){p+=this.textNodes[o].length}return p},toString:function(){var q=[];for(var o=0,p=this.textNodes.length;o<p;++o){q[o]="'"+this.textNodes[o].data+"'"}return"[Merge("+q.join(",")+")]"}};function f(r,o,q,p){this.tagNames=r||[b];this.cssClass=o||"";this.similarClassRegExp=q;this.normalize=p;this.applyToAnyTagName=false}f.prototype={getAncestorWithClass:function(p){var o;while(p){o=this.cssClass?d(p,this.cssClass,this.similarClassRegExp):true;if(p.nodeType==n.ELEMENT_NODE&&i.dom.arrayContains(this.tagNames,p.tagName.toLowerCase())&&o){return p}p=p.parentNode}return false},postApply:function(C,w){var p=C[0],r=C[C.length-1];var t=[],o;var z=p,x=r;var A=0,y=r.length;var B,v;for(var q=0,s=C.length;q<s;++q){B=C[q];v=this.getAdjacentMergeableTextNode(B.parentNode,false);if(v){if(!o){o=new h(v);t.push(o)}o.textNodes.push(B);if(B===p){z=o.firstTextNode;A=z.length}if(B===r){x=o.firstTextNode;y=o.getLength()}}else{o=null}}var u=this.getAdjacentMergeableTextNode(r.parentNode,true);if(u){if(!o){o=new h(r);t.push(o)}o.textNodes.push(u)}if(t.length){for(q=0,s=t.length;q<s;++q){t[q].doMerge()}w.setStart(z,A);w.setEnd(x,y)}},getAdjacentMergeableTextNode:function(s,q){var r=(s.nodeType==n.TEXT_NODE);var p=r?s.parentNode:s;var o;var t=q?"nextSibling":"previousSibling";if(r){o=s[t];if(o&&o.nodeType==n.TEXT_NODE){return o}}else{o=p[t];if(o&&this.areElementsMergeable(s,o)){return o[q?"firstChild":"lastChild"]}}return null},areElementsMergeable:function(o,p){return i.dom.arrayContains(this.tagNames,(o.tagName||"").toLowerCase())&&i.dom.arrayContains(this.tagNames,(p.tagName||"").toLowerCase())&&e(o,p)&&c(o,p)},createContainer:function(o){var p=o.createElement(this.tagNames[0]);if(this.cssClass){p.className=this.cssClass}return p},applyToTextNode:function(q){var p=q.parentNode;if(p.childNodes.length==1&&i.dom.arrayContains(this.tagNames,p.tagName.toLowerCase())){if(this.cssClass){a(p,this.cssClass,this.similarClassRegExp)}}else{var o=this.createContainer(i.dom.getDocument(q));q.parentNode.insertBefore(o,q);o.appendChild(q)}},isRemovable:function(o){return i.dom.arrayContains(this.tagNames,o.tagName.toLowerCase())&&n.lang.string(o.className).trim()==this.cssClass},undoToTextNode:function(r,q,p){if(!q.containsNode(p)){var o=q.cloneRange();o.selectNode(p);if(o.isPointInRange(q.endContainer,q.endOffset)&&g(q.endContainer,q.endOffset)){m(p,q.endContainer,q.endOffset);q.setEndAfter(p)}if(o.isPointInRange(q.startContainer,q.startOffset)&&g(q.startContainer,q.startOffset)){p=m(p,q.startContainer,q.startOffset)}}if(this.similarClassRegExp){k(p,this.similarClassRegExp)}if(this.isRemovable(p)){l(p)}},applyToRange:function(s){var u=s.getNodes([n.TEXT_NODE]);if(!u.length){try{var r=this.createContainer(s.endContainer.ownerDocument);s.surroundContents(r);this.selectNode(s,r);return}catch(o){}}s.splitBoundaries();u=s.getNodes([n.TEXT_NODE]);if(u.length){var t;for(var p=0,q=u.length;p<q;++p){t=u[p];if(!this.getAncestorWithClass(t)){this.applyToTextNode(t)}}s.setStart(u[0],0);t=u[u.length-1];s.setEnd(t,t.length);if(this.normalize){this.postApply(u,s)}}},undoToRange:function(t){var v=t.getNodes([n.TEXT_NODE]),u,o;if(v.length){t.splitBoundaries();v=t.getNodes([n.TEXT_NODE])}else{var p=t.endContainer.ownerDocument,s=p.createTextNode(n.INVISIBLE_SPACE);t.insertNode(s);t.selectNode(s);v=[s]}for(var q=0,r=v.length;q<r;++q){u=v[q];o=this.getAncestorWithClass(u);if(o){this.undoToTextNode(u,t,o)}}if(r==1){this.selectNode(t,v[0])}else{t.setStart(v[0],0);u=v[v.length-1];t.setEnd(u,u.length);if(this.normalize){this.postApply(v,t)}}},selectNode:function(u,t){var r=t.nodeType===n.ELEMENT_NODE,o="canHaveHTML" in t?t.canHaveHTML:true,p=r?t.innerHTML:t.data,s=(p===""||p===n.INVISIBLE_SPACE);if(s&&r&&o){try{t.innerHTML=n.INVISIBLE_SPACE}catch(q){}}u.selectNodeContents(t);if(s&&r){u.collapse(false)}else{if(s){u.setStartAfter(t);u.setEndAfter(t)}}},getTextSelectedByRange:function(r,p){var s=p.cloneRange();s.selectNodeContents(r);var o=s.intersection(p);var q=o?o.toString():"";s.detach();return q},isAppliedToRange:function(s){var p=[],o,u=s.getNodes([n.TEXT_NODE]);if(!u.length){o=this.getAncestorWithClass(s.startContainer);return o?[o]:false}for(var q=0,r=u.length,t;q<r;++q){t=this.getTextSelectedByRange(u[q],s);o=this.getAncestorWithClass(u[q]);if(t!=""&&!o){return false}else{p.push(o)}}return p},toggleRange:function(o){if(this.isAppliedToRange(o)){this.undoToRange(o)}else{this.applyToRange(o)}}};n.selection.HTMLApplier=f})(wysihtml5,rangy);wysihtml5.Commands=Base.extend({constructor:function(a){this.editor=a;this.composer=a.composer;this.doc=this.composer.doc},support:function(a){return wysihtml5.browser.supportsCommand(this.doc,a)},exec:function(b,h){var f=wysihtml5.commands[b],a=wysihtml5.lang.array(arguments).get(),d=f&&f.exec,g=null;this.editor.fire("beforecommand:composer");if(d){a.unshift(this.composer);g=d.apply(f,a)}else{try{g=this.doc.execCommand(b,false,h)}catch(c){}}this.editor.fire("aftercommand:composer");return g},state:function(b,c){var g=wysihtml5.commands[b],a=wysihtml5.lang.array(arguments).get(),f=g&&g.state;if(f){a.unshift(this.composer);return f.apply(g,a)}else{try{return this.doc.queryCommandState(b)}catch(d){return false}}},value:function(a){var d=wysihtml5.commands[a],c=d&&d.value;if(c){return c.call(d,this.composer,a)}else{try{return this.doc.queryCommandValue(a)}catch(b){return null}}}});(function(b){var a;b.commands.bold={exec:function(d,c){return b.commands.formatInline.exec(d,c,"b")},state:function(e,d,c){return b.commands.formatInline.state(e,d,"b")},value:function(){return a}}})(wysihtml5);(function(f){var e,d="A",c=f.dom;function b(k,h){var m=h.length,l=0,g,j,n;for(;l<m;l++){g=h[l];j=c.getParentElement(g,{nodeName:"code"});n=c.getTextContent(g);if(n.match(c.autoLink.URL_REG_EXP)&&!j){j=c.renameElement(g,"code")}else{c.replaceWithChildNodes(g)}}}function a(l,k){var m=l.doc,t="_wysihtml5-temp-"+(+new Date()),u=/non-matching-class/g,p=0,s,h,g,o,q,n,v,w,r;f.commands.formatInline.exec(l,e,d,t,u);h=m.querySelectorAll(d+"."+t);s=h.length;for(;p<s;p++){g=h[p];g.removeAttribute("class");for(r in k){g.setAttribute(r,k[r])}}n=g;if(s===1){v=c.getTextContent(g);o=!!g.querySelector("*");q=v===""||v===f.INVISIBLE_SPACE;if(!o&&q){c.setTextContent(g,k.text||g.href);w=m.createTextNode(" ");l.selection.setAfter(g);l.selection.insertNode(w);n=w}}l.selection.setAfter(n)}f.commands.createLink={exec:function(i,h,j){var g=this.state(i,h);if(g){i.selection.executeAndRestore(function(){b(i,g)})}else{j=typeof(j)==="object"?j:{href:j};a(i,j)}},state:function(h,g){return f.commands.formatInline.state(h,g,"A")},value:function(){return e}}})(wysihtml5);(function(c){var b,a=/wysiwyg-font-size-[a-z\-]+/g;c.commands.fontSize={exec:function(e,d,f){return c.commands.formatInline.exec(e,d,"span","wysiwyg-font-size-"+f,a)},state:function(e,d,f){return c.commands.formatInline.state(e,d,"span","wysiwyg-font-size-"+f,a)},value:function(){return b}}})(wysihtml5);(function(c){var b,a=/wysiwyg-color-[a-z]+/g;c.commands.foreColor={exec:function(f,e,d){return c.commands.formatInline.exec(f,e,"span","wysiwyg-color-"+d,a)},state:function(f,e,d){return c.commands.formatInline.state(f,e,"span","wysiwyg-color-"+d,a)},value:function(){return b}}})(wysihtml5);(function(r){var q,p=r.dom,o="DIV",n=["H1","H2","H3","H4","H5","H6","P","BLOCKQUOTE",o];function a(u,s,t){if(u.className){j(u,t);u.className+=" "+s}else{u.className=s}}function j(t,s){t.className=t.className.replace(s,"")}function g(s){return s.nodeType===r.TEXT_NODE&&!r.lang.string(s.data).trim()}function e(s){var t=s.previousSibling;while(t&&g(t)){t=t.previousSibling}return t}function d(t){var s=t.nextSibling;while(s&&g(s)){s=s.nextSibling}return s}function b(u){var s=u.ownerDocument,t=d(u),v=e(u);if(t&&!i(t)){u.parentNode.insertBefore(s.createElement("br"),t)}if(v&&!i(v)){u.parentNode.insertBefore(s.createElement("br"),u)}}function l(t){var s=d(t),u=e(t);if(s&&h(s)){s.parentNode.removeChild(s)}if(u&&h(u)){u.parentNode.removeChild(u)}}function k(t){var s=t.lastChild;if(s&&h(s)){s.parentNode.removeChild(s)}}function h(s){return s.nodeName==="BR"}function i(s){if(h(s)){return true}if(p.getStyle("display").from(s)==="block"){return true}return false}function c(u,t,w,s){if(s){var v=p.observe(u,"DOMNodeInserted",function(y){var z=y.target,x;if(z.nodeType!==r.ELEMENT_NODE){return}x=p.getStyle("display").from(z);if(x.substr(0,6)!=="inline"){z.className+=" "+s}})}u.execCommand(t,false,w);if(v){v.stop()}}function m(s,t){s.selection.selectLine();s.selection.surround(t);l(t);k(t);s.selection.selectNode(t)}function f(s){return !!r.lang.string(s.className).trim()}r.commands.formatBlock={exec:function(w,v,y,t,u){var x=w.doc,s=this.state(w,v,y,t,u),z;y=typeof(y)==="string"?y.toUpperCase():y;if(s){w.selection.executeAndRestoreSimple(function(){if(u){j(s,u)}var A=f(s);if(!A&&s.nodeName===(y||o)){b(s);p.replaceWithChildNodes(s)}else{if(A){p.renameElement(s,o)}}});return}if(y===null||r.lang.array(n).contains(y)){z=w.selection.getSelectedNode();s=p.getParentElement(z,{nodeName:n});if(s){w.selection.executeAndRestoreSimple(function(){if(y){s=p.renameElement(s,y)}if(t){a(s,t,u)}});return}}if(w.commands.support(v)){c(x,v,y||o,t);return}s=x.createElement(y||o);if(t){s.className=t}m(w,s)},state:function(v,u,w,s,t){w=typeof(w)==="string"?w.toUpperCase():w;var x=v.selection.getSelectedNode();return p.getParentElement(x,{nodeName:w,className:s,classRegExp:t})},value:function(){return q}}})(wysihtml5);(function(f){var e,c={strong:"b",em:"i",b:"strong",i:"em"},d={};function b(h){var g=c[h];return g?[h.toLowerCase(),g.toLowerCase()]:[h.toLowerCase()]}function a(j,g,h){var i=j+":"+g;if(!d[i]){d[i]=new f.selection.HTMLApplier(b(j),g,h,true)}return d[i]}f.commands.formatInline={exec:function(j,i,l,g,h){var k=j.selection.getRange();if(!k){return false}a(l,g,h).toggleRange(k);j.selection.setSelection(k)},state:function(k,j,n,h,i){var l=k.doc,g=c[n]||n,m;if(!f.dom.hasElementWithTagName(l,n)&&!f.dom.hasElementWithTagName(l,g)){return false}if(h&&!f.dom.hasElementWithClassName(l,h)){return false}m=k.selection.getRange();if(!m){return false}return a(n,h,i).isAppliedToRange(m)},value:function(){return e}}})(wysihtml5);(function(b){var a;b.commands.insertHTML={exec:function(d,c,e){if(d.commands.support(c)){d.doc.execCommand(c,false,e)}else{d.selection.insertHTML(e)}},state:function(){return false},value:function(){return a}}})(wysihtml5);(function(b){var a="IMG";b.commands.insertImage={exec:function(d,c,k){k=typeof(k)==="object"?k:{src:k};var e=d.doc,g=this.state(d),j,f,h;if(g){d.selection.setBefore(g);h=g.parentNode;h.removeChild(g);b.dom.removeEmptyTextNodes(h);if(h.nodeName==="A"&&!h.firstChild){d.selection.setAfter(h);h.parentNode.removeChild(h)}b.quirks.redraw(d.element);return}g=e.createElement(a);for(f in k){g[f]=k[f]}d.selection.insertNode(g);if(b.browser.hasProblemsSettingCaretAfterImg()){j=e.createTextNode(b.INVISIBLE_SPACE);d.selection.insertNode(j);d.selection.setAfter(j)}else{d.selection.setAfter(g)}},state:function(c){var d=c.doc,f,g,e;if(!b.dom.hasElementWithTagName(d,a)){return false}f=c.selection.getSelectedNode();if(!f){return false}if(f.nodeName===a){return f}if(f.nodeType!==b.ELEMENT_NODE){return false}g=c.selection.getText();g=b.lang.string(g).trim();if(g){return false}e=c.selection.getNodes(b.ELEMENT_NODE,function(h){return h.nodeName==="IMG"});if(e.length!==1){return false}return e[0]},value:function(c){var d=this.state(c);return d&&d.src}}})(wysihtml5);(function(c){var b,a="<br>"+(c.browser.needsSpaceAfterLineBreak()?" ":"");c.commands.insertLineBreak={exec:function(e,d){if(e.commands.support(d)){e.doc.execCommand(d,false,null);if(!c.browser.autoScrollsToCaret()){e.selection.scrollIntoView()}}else{e.commands.exec("insertHTML",a)}},state:function(){return false},value:function(){return b}}})(wysihtml5);(function(b){var a;b.commands.insertOrderedList={exec:function(d,c){var e=d.doc,i=d.selection.getSelectedNode(),g=b.dom.getParentElement(i,{nodeName:"OL"}),h=b.dom.getParentElement(i,{nodeName:"UL"}),j="_wysihtml5-temp-"+new Date().getTime(),f,k;if(d.commands.support(c)){e.execCommand(c,false,null);return}if(g){d.selection.executeAndRestoreSimple(function(){b.dom.resolveList(g)})}else{if(h){d.selection.executeAndRestoreSimple(function(){b.dom.renameElement(h,"ol")})}else{d.commands.exec("formatBlock","div",j);k=e.querySelector("."+j);f=k.innerHTML===""||k.innerHTML===b.INVISIBLE_SPACE;d.selection.executeAndRestoreSimple(function(){g=b.dom.convertToList(k,"ol")});if(f){d.selection.selectNode(g.querySelector("li"))}}}},state:function(c){var d=c.selection.getSelectedNode();return b.dom.getParentElement(d,{nodeName:"OL"})},value:function(){return a}}})(wysihtml5);(function(b){var a;b.commands.insertUnorderedList={exec:function(d,c){var e=d.doc,i=d.selection.getSelectedNode(),g=b.dom.getParentElement(i,{nodeName:"UL"}),h=b.dom.getParentElement(i,{nodeName:"OL"}),j="_wysihtml5-temp-"+new Date().getTime(),f,k;if(d.commands.support(c)){e.execCommand(c,false,null);return}if(g){d.selection.executeAndRestoreSimple(function(){b.dom.resolveList(g)})}else{if(h){d.selection.executeAndRestoreSimple(function(){b.dom.renameElement(h,"ul")})}else{d.commands.exec("formatBlock","div",j);k=e.querySelector("."+j);f=k.innerHTML===""||k.innerHTML===b.INVISIBLE_SPACE;d.selection.executeAndRestoreSimple(function(){g=b.dom.convertToList(k,"ul")});if(f){d.selection.selectNode(g.querySelector("li"))}}}},state:function(c){var d=c.selection.getSelectedNode();return b.dom.getParentElement(d,{nodeName:"UL"})},value:function(){return a}}})(wysihtml5);(function(b){var a;b.commands.italic={exec:function(d,c){return b.commands.formatInline.exec(d,c,"i")},state:function(e,d,c){return b.commands.formatInline.state(e,d,"i")},value:function(){return a}}})(wysihtml5);(function(d){var c,a="wysiwyg-text-align-center",b=/wysiwyg-text-align-[a-z]+/g;d.commands.justifyCenter={exec:function(f,e){return d.commands.formatBlock.exec(f,"formatBlock",null,a,b)},state:function(f,e){return d.commands.formatBlock.state(f,"formatBlock",null,a,b)},value:function(){return c}}})(wysihtml5);(function(d){var c,a="wysiwyg-text-align-left",b=/wysiwyg-text-align-[a-z]+/g;d.commands.justifyLeft={exec:function(f,e){return d.commands.formatBlock.exec(f,"formatBlock",null,a,b)},state:function(f,e){return d.commands.formatBlock.state(f,"formatBlock",null,a,b)},value:function(){return c}}})(wysihtml5);(function(d){var c,a="wysiwyg-text-align-right",b=/wysiwyg-text-align-[a-z]+/g;d.commands.justifyRight={exec:function(f,e){return d.commands.formatBlock.exec(f,"formatBlock",null,a,b)},state:function(f,e){return d.commands.formatBlock.state(f,"formatBlock",null,a,b)},value:function(){return c}}})(wysihtml5);(function(b){var a;b.commands.underline={exec:function(d,c){return b.commands.formatInline.exec(d,c,"u")},state:function(d,c){return b.commands.formatInline.state(d,c,"u")},value:function(){return a}}})(wysihtml5);(function(h){var j=90,i=89,a=8,c=46,e=40,g='<span id="_wysihtml5-undo" class="_wysihtml5-temp">'+h.INVISIBLE_SPACE+"</span>",f='<span id="_wysihtml5-redo" class="_wysihtml5-temp">'+h.INVISIBLE_SPACE+"</span>",d=h.dom;function b(k){var l;while(l=k.querySelector("._wysihtml5-temp")){l.parentNode.removeChild(l)}}h.UndoManager=h.lang.Dispatcher.extend({constructor:function(k){this.editor=k;this.composer=k.composer;this.element=this.composer.element;this.history=[this.composer.getValue()];this.position=1;if(this.composer.commands.support("insertHTML")){this._observe()}},_observe:function(){var p=this,l=this.composer.sandbox.getDocument(),n;d.observe(this.element,"keydown",function(q){if(q.altKey||(!q.ctrlKey&&!q.metaKey)){return}var t=q.keyCode,s=t===j&&!q.shiftKey,r=(t===j&&q.shiftKey)||(t===i);if(s){p.undo();q.preventDefault()}else{if(r){p.redo();q.preventDefault()}}});d.observe(this.element,"keydown",function(q){var r=q.keyCode;if(r===n){return}n=r;if(r===a||r===c){p.transact()}});if(h.browser.hasUndoInContextMenu()){var m,o,k=function(){b(l);clearInterval(m)};d.observe(this.element,"contextmenu",function(){k();p.composer.selection.executeAndRestoreSimple(function(){if(p.element.lastChild){p.composer.selection.setAfter(p.element.lastChild)}l.execCommand("insertHTML",false,g);l.execCommand("insertHTML",false,f);l.execCommand("undo",false,null)});m=setInterval(function(){if(l.getElementById("_wysihtml5-redo")){k();p.redo()}else{if(!l.getElementById("_wysihtml5-undo")){k();p.undo()}}},400);if(!o){o=true;d.observe(document,"mousedown",k);d.observe(l,["mousedown","paste","cut","copy"],k)}})}this.editor.observe("newword:composer",function(){p.transact()}).observe("beforecommand:composer",function(){p.transact()})},transact:function(){var m=this.history[this.position-1],k=this.composer.getValue();if(k==m){return}var l=this.history.length=this.position;if(l>e){this.history.shift();this.position--}this.position++;this.history.push(k)},undo:function(){this.transact();if(this.position<=1){return}this.set(this.history[--this.position-1]);this.editor.fire("undo:composer")},redo:function(){if(this.position>=this.history.length){return}this.set(this.history[++this.position-1]);this.editor.fire("redo:composer")},set:function(k){this.composer.setValue(k);this.editor.focus(true)}})})(wysihtml5);wysihtml5.views.View=Base.extend({constructor:function(b,c,a){this.parent=b;this.element=c;this.config=a;this._observeViewChange()},_observeViewChange:function(){var a=this;this.parent.observe("beforeload",function(){a.parent.observe("change_view",function(b){if(b===a.name){a.parent.currentView=a;a.show();setTimeout(function(){a.focus()},0)}else{a.hide()}})})},focus:function(){if(this.element.ownerDocument.querySelector(":focus")===this.element){return}try{this.element.focus()}catch(a){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}});(function(c){var b=c.dom,a=c.browser;c.views.Composer=c.views.View.extend({name:"composer",CARET_HACK:"<br>",constructor:function(e,f,d){this.base(e,f,d);this.textarea=this.parent.textarea;this._initSandbox()},clear:function(){this.element.innerHTML=a.displaysCaretInEmptyContentEditableCorrectly()?"":this.CARET_HACK},getValue:function(d){var e=this.isEmpty()?"":c.quirks.getCorrectInnerHTML(this.element);if(d){e=this.parent.parse(e)}e=c.lang.string(e).replace(c.INVISIBLE_SPACE).by("");return e},setValue:function(d,e){if(e){d=this.parent.parse(d)}this.element.innerHTML=d},show:function(){this.iframe.style.display=this._displayStyle||"";this.disable();this.enable()},hide:function(){this._displayStyle=b.getStyle("display").from(this.iframe);if(this._displayStyle==="none"){this._displayStyle=null}this.iframe.style.display="none"},disable:function(){this.element.removeAttribute("contentEditable");this.base()},enable:function(){this.element.setAttribute("contentEditable","true");this.base()},focus:function(e){if(c.browser.doesAsyncFocus()&&this.hasPlaceholderSet()){this.clear()}this.base();var d=this.element.lastChild;if(e&&d){if(d.nodeName==="BR"){this.selection.setBefore(this.element.lastChild)}else{this.selection.setAfter(this.element.lastChild)}}},getTextContent:function(){return b.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==this.textarea.element.getAttribute("placeholder")},isEmpty:function(){var e=this.element.innerHTML,d="blockquote, ul, ol, img, embed, object, table, iframe, svg, video, audio, button, input, select, textarea";return e===""||e===this.CARET_HACK||this.hasPlaceholderSet()||(this.getTextContent()===""&&!this.element.querySelector(d))},_initSandbox:function(){var f=this;this.sandbox=new b.Sandbox(function(){f._create()},{stylesheets:this.config.stylesheets});this.iframe=this.sandbox.getIframe();var d=document.createElement("input");d.type="hidden";d.name="_wysihtml5_mode";d.value=1;var e=this.textarea.element;b.insert(this.iframe).after(e);b.insert(d).after(e)},_create:function(){var f=this;this.doc=this.sandbox.getDocument();this.element=this.doc.body;this.textarea=this.parent.textarea;this.element.innerHTML=this.textarea.getValue(true);this.enable();this.selection=new c.Selection(this.parent);this.commands=new c.Commands(this.parent);b.copyAttributes(["className","spellcheck","title","lang","dir","accessKey"]).from(this.textarea.element).to(this.element);b.addClass(this.element,this.config.composerClassName);if(this.config.style){this.style()}this.observe();var d=this.config.name;if(d){b.addClass(this.element,d);b.addClass(this.iframe,d)}var e=typeof(this.config.placeholder)==="string"?this.config.placeholder:this.textarea.element.getAttribute("placeholder");if(e){b.simulatePlaceholder(this.parent,this,e)}this.commands.exec("styleWithCSS",false);this._initAutoLinking();this._initObjectResizing();this._initUndoManager();if(this.textarea.element.hasAttribute("autofocus")||document.querySelector(":focus")==this.textarea.element){setTimeout(function(){f.focus()},100)}c.quirks.insertLineBreakOnReturn(this);if(!a.clearsContentEditableCorrectly()){c.quirks.ensureProperClearing(this)}if(!a.clearsListsInContentEditableCorrectly()){c.quirks.ensureProperClearingOfLists(this)}if(this.initSync&&this.config.sync){this.initSync()}this.textarea.hide();this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var h=this,g=a.canDisableAutoLinking(),f=a.doesAutoLinkingInContentEditable();if(g){this.commands.exec("autoUrlDetect",false)}if(!this.config.autoLink){return}if(!f||(f&&g)){this.parent.observe("newword:composer",function(){h.selection.executeAndRestore(function(k,j){b.autoLink(j.parentNode)})})}var e=this.sandbox.getDocument().getElementsByTagName("a"),i=b.autoLink.URL_REG_EXP,d=function(j){var k=c.lang.string(b.getTextContent(j)).trim();if(k.substr(0,4)==="www."){k="http://"+k}return k};b.observe(this.element,"keydown",function(j){if(!e.length){return}var l=h.selection.getSelectedNode(j.target.ownerDocument),k=b.getParentElement(l,{nodeName:"A"},4),m;if(!k){return}m=d(k);setTimeout(function(){var n=d(k);if(n===m){return}if(n.match(i)){k.setAttribute("href",n)}},0)})},_initObjectResizing:function(){var e=["width","height"],f=e.length,d=this.element;this.commands.exec("enableObjectResizing",this.config.allowObjectResizing);if(this.config.allowObjectResizing){if(a.supportsEvent("resizeend")){b.observe(d,"resizeend",function(g){var l=g.target||g.srcElement,k=l.style,h=0,j;for(;h<f;h++){j=e[h];if(k[j]){l.setAttribute(j,parseInt(k[j],10));k[j]=""}}c.quirks.redraw(d)})}}else{if(a.supportsEvent("resizestart")){b.observe(d,"resizestart",function(g){g.preventDefault()})}}},_initUndoManager:function(){new c.UndoManager(this.parent)}})})(wysihtml5);(function(j){var d=j.dom,c=document,i=window,f=c.createElement("div"),h=["background-color","color","cursor","font-family","font-size","font-style","font-variant","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-rendering","word-break","word-wrap","word-spacing"],b=["background-color","border-collapse","border-bottom-color","border-bottom-style","border-bottom-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-style","border-top-width","clear","display","float","margin-bottom","margin-left","margin-right","margin-top","outline-color","outline-offset","outline-width","outline-style","padding-left","padding-right","padding-top","padding-bottom","position","top","left","right","bottom","z-index","vertical-align","text-align","-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing","-webkit-box-shadow","-moz-box-shadow","-ms-box-shadow","box-shadow","-webkit-border-top-right-radius","-moz-border-radius-topright","border-top-right-radius","-webkit-border-bottom-right-radius","-moz-border-radius-bottomright","border-bottom-right-radius","-webkit-border-bottom-left-radius","-moz-border-radius-bottomleft","border-bottom-left-radius","-webkit-border-top-left-radius","-moz-border-radius-topleft","border-top-left-radius","width","height"],g=["width","height","top","left","right","bottom"],a=["html             { height: 100%; }","body             { min-height: 100%; padding: 0; margin: 0; margin-top: -1px; padding-top: 1px; }","._wysihtml5-temp { display: none; }",j.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","body[disabled]   { background-color: #eee !important; color: #999 !important; cursor: default !important; }","img:-moz-broken  { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"];var e=function(l){if(l.setActive){try{l.setActive()}catch(k){}}else{var m=l.style,o=c.documentElement.scrollTop||c.body.scrollTop,n=c.documentElement.scrollLeft||c.body.scrollLeft,p={position:m.position,top:m.top,left:m.left,WebkitUserSelect:m.WebkitUserSelect};d.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(l);l.focus();d.setStyles(p).on(l);if(i.scrollTo){i.scrollTo(n,o)}}};j.views.Composer.prototype.style=function(){var p=this,m=c.querySelector(":focus"),o=this.textarea.element,l=o.hasAttribute("placeholder"),n=l&&o.getAttribute("placeholder");this.focusStylesHost=this.focusStylesHost||f.cloneNode(false);this.blurStylesHost=this.blurStylesHost||f.cloneNode(false);if(l){o.removeAttribute("placeholder")}if(o===m){o.blur()}d.copyStyles(b).from(o).to(this.iframe).andTo(this.blurStylesHost);d.copyStyles(h).from(o).to(this.element).andTo(this.blurStylesHost);d.insertCSS(a).into(this.element.ownerDocument);e(o);d.copyStyles(b).from(o).to(this.focusStylesHost);d.copyStyles(h).from(o).to(this.focusStylesHost);var k=j.lang.array(b).without(["display"]);if(m){m.focus()}else{o.blur()}if(l){o.setAttribute("placeholder",n)}if(!j.browser.hasCurrentStyleProperty()){var q=d.observe(i,"resize",function(){if(!d.contains(document.documentElement,p.iframe)){q.stop();return}var s=d.getStyle("display").from(o),r=d.getStyle("display").from(p.iframe);o.style.display="";p.iframe.style.display="none";d.copyStyles(g).from(o).to(p.iframe).andTo(p.focusStylesHost).andTo(p.blurStylesHost);p.iframe.style.display=r;o.style.display=s})}this.parent.observe("focus:composer",function(){d.copyStyles(k).from(p.focusStylesHost).to(p.iframe);d.copyStyles(h).from(p.focusStylesHost).to(p.element)});this.parent.observe("blur:composer",function(){d.copyStyles(k).from(p.blurStylesHost).to(p.iframe);d.copyStyles(h).from(p.blurStylesHost).to(p.element)});return this}})(wysihtml5);(function(d){var b=d.dom,a=d.browser,c={"66":"bold","73":"italic","85":"underline"};d.views.Composer.prototype.observe=function(){var k=this,j=this.getValue(),h=this.sandbox.getIframe(),f=this.element,g=a.supportsEventsInIframeCorrectly()?f:this.sandbox.getWindow(),i=a.supportsEvent("drop")?["drop","paste"]:["dragdrop","paste"];b.observe(h,"DOMNodeRemoved",function(){clearInterval(e);k.parent.fire("destroy:composer")});var e=setInterval(function(){if(!b.contains(document.documentElement,h)){clearInterval(e);k.parent.fire("destroy:composer")}},250);b.observe(g,"focus",function(){k.parent.fire("focus").fire("focus:composer");setTimeout(function(){j=k.getValue()},0)});b.observe(g,"blur",function(){if(j!==k.getValue()){k.parent.fire("change").fire("change:composer")}k.parent.fire("blur").fire("blur:composer")});if(d.browser.isIos()){b.observe(f,"blur",function(){var n=f.ownerDocument.createElement("input"),p=document.documentElement.scrollTop||document.body.scrollTop,o=document.documentElement.scrollLeft||document.body.scrollLeft;try{k.selection.insertNode(n)}catch(m){f.appendChild(n)}n.focus();n.parentNode.removeChild(n);window.scrollTo(o,p)})}b.observe(f,"dragenter",function(){k.parent.fire("unset_placeholder")});if(a.firesOnDropOnlyWhenOnDragOverIsCancelled()){b.observe(f,["dragover","dragenter"],function(m){m.preventDefault()})}b.observe(f,i,function(o){var n=o.dataTransfer,m;if(n&&a.supportsDataTransfer()){m=n.getData("text/html")||n.getData("text/plain")}if(m){f.focus();k.commands.exec("insertHTML",m);k.parent.fire("paste").fire("paste:composer");o.stopPropagation();o.preventDefault()}else{setTimeout(function(){k.parent.fire("paste").fire("paste:composer")},0)}});b.observe(f,"keyup",function(m){var n=m.keyCode;if(n===d.SPACE_KEY||n===d.ENTER_KEY){k.parent.fire("newword:composer")}});this.parent.observe("paste:composer",function(){setTimeout(function(){k.parent.fire("newword:composer")},0)});if(!a.canSelectImagesInContentEditable()){b.observe(f,"mousedown",function(m){var n=m.target;if(n.nodeName==="IMG"){k.selection.selectNode(n);m.preventDefault()}})}b.observe(f,"keydown",function(n){var o=n.keyCode,m=c[o];if((n.ctrlKey||n.metaKey)&&!n.altKey&&m){k.commands.exec(m);n.preventDefault()}});b.observe(f,"keydown",function(m){var p=k.selection.getSelectedNode(true),n=m.keyCode,o;if(p&&p.nodeName==="IMG"&&(n===d.BACKSPACE_KEY||n===d.DELETE_KEY)){o=p.parentNode;o.removeChild(p);if(o.nodeName==="A"&&!o.firstChild){o.parentNode.removeChild(o)}setTimeout(function(){d.quirks.redraw(f)},0);m.preventDefault()}});var l={IMG:"Image: ",A:"Link: "};b.observe(f,"mouseover",function(m){var p=m.target,o=p.nodeName,q;if(o!=="A"&&o!=="IMG"){return}var n=p.hasAttribute("title");if(!n){q=l[o]+(p.getAttribute("href")||p.getAttribute("src"));p.setAttribute("title",q)}})}})(wysihtml5);(function(b){var a=400;b.views.Synchronizer=Base.extend({constructor:function(d,e,c){this.editor=d;this.textarea=e;this.composer=c;this._observe()},fromComposerToTextarea:function(c){this.textarea.setValue(b.lang.string(this.composer.getValue()).trim(),c)},fromTextareaToComposer:function(c){var d=this.textarea.getValue();if(d){this.composer.setValue(d,c)}else{this.composer.clear();this.editor.fire("set_placeholder")}},sync:function(c){if(this.editor.currentView.name==="textarea"){this.fromTextareaToComposer(c)}else{this.fromComposerToTextarea(c)}},_observe:function(){var d,g=this,c=this.textarea.element.form,e=function(){d=setInterval(function(){g.fromComposerToTextarea()},a)},f=function(){clearInterval(d);d=null};e();if(c){b.dom.observe(c,"submit",function(){g.sync(true)});b.dom.observe(c,"reset",function(){setTimeout(function(){g.fromTextareaToComposer()},0)})}this.editor.observe("change_view",function(h){if(h==="composer"&&!d){g.fromTextareaToComposer(true);e()}else{if(h==="textarea"){g.fromComposerToTextarea(true);f()}}});this.editor.observe("destroy:composer",f)}})})(wysihtml5);wysihtml5.views.Textarea=wysihtml5.views.View.extend({name:"textarea",constructor:function(b,c,a){this.base(b,c,a);this._observe()},clear:function(){this.element.value=""},getValue:function(a){var b=this.isEmpty()?"":this.element.value;if(a){b=this.parent.parse(b)}return b},setValue:function(a,b){if(b){a=this.parent.parse(a)}this.element.value=a},hasPlaceholderSet:function(){var c=wysihtml5.browser.supportsPlaceholderAttributeOn(this.element),b=this.element.getAttribute("placeholder")||null,d=this.element.value,a=!d;return(c&&a)||(d===b)},isEmpty:function(){return !wysihtml5.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var a=this.element,d=this.parent,b={focusin:"focus",focusout:"blur"},c=wysihtml5.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];d.observe("beforeload",function(){wysihtml5.dom.observe(a,c,function(e){var f=b[e.type]||e.type;d.fire(f).fire(f+":textarea")});wysihtml5.dom.observe(a,["paste","drop"],function(){setTimeout(function(){d.fire("paste").fire("paste:textarea")},0)})})}});(function(f){var c=f.dom,b="wysihtml5-command-dialog-opened",e="input, select, textarea",d="[data-wysihtml5-dialog-field]",a="data-wysihtml5-dialog-field";f.toolbar.Dialog=f.lang.Dispatcher.extend({constructor:function(h,g){this.link=h;this.container=g},_observe:function(){if(this._observed){return}var m=this,h=function(n){var i=m._serialize();if(i==m.elementToChange){m.fire("edit",i)}else{m.fire("save",i)}m.hide();n.preventDefault();n.stopPropagation()};c.observe(m.link,"click",function(i){if(c.hasClass(m.link,b)){setTimeout(function(){m.hide()},0)}});c.observe(this.container,"keydown",function(i){var n=i.keyCode;if(n===f.ENTER_KEY){h(i)}if(n===f.ESCAPE_KEY){m.hide()}});c.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",h);c.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(i){m.fire("cancel");m.hide();i.preventDefault();i.stopPropagation()});var j=this.container.querySelectorAll(e),k=0,l=j.length,g=function(){clearInterval(m.interval)};for(;k<l;k++){c.observe(j[k],"change",g)}this._observed=true},_serialize:function(){var g=this.elementToChange||{},h=this.container.querySelectorAll(d),k=h.length,j=0;for(;j<k;j++){g[h[j].getAttribute(a)]=h[j].value}return g},_interpolate:function(g){var h,j,o,l=document.querySelector(":focus"),k=this.container.querySelectorAll(d),n=k.length,m=0;for(;m<n;m++){h=k[m];if(h===l){continue}if(g&&h.type==="hidden"){continue}j=h.getAttribute(a);o=this.elementToChange?(this.elementToChange[j]||""):h.defaultValue;h.value=o}},show:function(h){var j=this,i=this.container.querySelector(e);this.elementToChange=h;this._observe();this._interpolate();if(h){this.interval=setInterval(function(){j._interpolate(true)},500)}c.addClass(this.link,b);this.container.style.display="";this.fire("show");if(i&&!h){try{i.focus()}catch(g){}}},hide:function(){clearInterval(this.interval);this.elementToChange=null;c.removeClass(this.link,b);this.container.style.display="none";this.fire("hide")}})})(wysihtml5);(function(f){var a=f.dom;var d={position:"relative"};var e={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1};var c={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"};var b={"x-webkit-speech":"",speech:""};f.toolbar.Speech=function(j,i){var h=document.createElement("input");if(!f.browser.supportsSpeechApiOn(h)){i.style.display="none";return}var k=document.createElement("div");f.lang.object(e).merge({width:i.offsetWidth+"px",height:i.offsetHeight+"px"});a.insert(h).into(k);a.insert(k).into(i);a.setStyles(c).on(h);a.setAttributes(b).on(h);a.setStyles(e).on(k);a.setStyles(d).on(i);var g="onwebkitspeechchange" in h?"webkitspeechchange":"speechchange";a.observe(h,g,function(){j.execCommand("insertText",h.value);h.value=""});a.observe(h,"click",function(l){if(a.hasClass(i,"wysihtml5-command-disabled")){l.preventDefault()}l.stopPropagation()})}})(wysihtml5);(function(f){var c="wysihtml5-command-disabled",d="wysihtml5-commands-disabled",b="wysihtml5-command-active",a="wysihtml5-action-active",e=f.dom;f.toolbar.Toolbar=Base.extend({constructor:function(h,g){this.editor=h;this.container=typeof(g)==="string"?document.getElementById(g):g;this.composer=h.composer;this._getLinks("command");this._getLinks("action");this._observe();this.show();var l=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"),k=l.length,j=0;for(;j<k;j++){new f.toolbar.Speech(this,l[j])}},_getLinks:function(p){var m=this[p+"Links"]=f.lang.array(this.container.querySelectorAll("[data-wysihtml5-"+p+"]")).get(),k=m.length,j=0,n=this[p+"Mapping"]={},l,h,o,q,g;for(;j<k;j++){l=m[j];o=l.getAttribute("data-wysihtml5-"+p);q=l.getAttribute("data-wysihtml5-"+p+"-value");h=this.container.querySelector("[data-wysihtml5-"+p+"-group='"+o+"']");g=this._getDialog(l,o);n[o+":"+q]={link:l,group:h,name:o,value:q,dialog:g,state:false}}},_getDialog:function(k,h){var l=this,j=this.container.querySelector("[data-wysihtml5-dialog='"+h+"']"),i,g;if(j){i=new f.toolbar.Dialog(k,j);i.observe("show",function(){g=l.composer.selection.getBookmark();l.editor.fire("show:dialog",{command:h,dialogContainer:j,commandLink:k})});i.observe("save",function(m){if(g){l.composer.selection.setBookmark(g)}l._execCommand(h,m);l.editor.fire("save:dialog",{command:h,dialogContainer:j,commandLink:k})});i.observe("cancel",function(){l.editor.focus(false);l.editor.fire("cancel:dialog",{command:h,dialogContainer:j,commandLink:k})})}return i},execCommand:function(g,i){if(this.commandsDisabled){return}var h=this.commandMapping[g+":"+i];if(h&&h.dialog&&!h.state){h.dialog.show()}else{this._execCommand(g,i)}},_execCommand:function(g,h){this.editor.focus(false);this.composer.commands.exec(g,h);this._updateLinkStates()},execAction:function(g){var h=this.editor;switch(g){case"change_view":if(h.currentView===h.textarea){h.fire("change_view","composer")}else{h.fire("change_view","textarea")}break}},_observe:function(){var m=this,h=this.editor,g=this.container,l=this.commandLinks.concat(this.actionLinks),k=l.length,j=0;for(;j<k;j++){e.setAttributes({href:"javascript:;",unselectable:"on"}).on(l[j])}e.delegate(g,"[data-wysihtml5-command]","mousedown",function(i){i.preventDefault()});e.delegate(g,"[data-wysihtml5-command]","click",function(o){var p=this,i=p.getAttribute("data-wysihtml5-command"),n=p.getAttribute("data-wysihtml5-command-value");m.execCommand(i,n);o.preventDefault()});e.delegate(g,"[data-wysihtml5-action]","click",function(n){var i=this.getAttribute("data-wysihtml5-action");m.execAction(i);n.preventDefault()});h.observe("focus:composer",function(){m.bookmark=null;clearInterval(m.interval);m.interval=setInterval(function(){m._updateLinkStates()},500)});h.observe("blur:composer",function(){clearInterval(m.interval)});h.observe("destroy:composer",function(){clearInterval(m.interval)});h.observe("change_view",function(i){setTimeout(function(){m.commandsDisabled=(i!=="composer");m._updateLinkStates();if(m.commandsDisabled){e.addClass(g,d)}else{e.removeClass(g,d)}},0)})},_updateLinkStates:function(){var l=this.composer.element,k=this.commandMapping,h=this.actionMapping,m,n,g,j;for(m in k){j=k[m];if(this.commandsDisabled){n=false;e.removeClass(j.link,b);if(j.group){e.removeClass(j.group,b)}if(j.dialog){j.dialog.hide()}}else{n=this.composer.commands.state(j.name,j.value);if(f.lang.object(n).isArray()){n=n.length===1?n[0]:true}e.removeClass(j.link,c);if(j.group){e.removeClass(j.group,c)}}if(j.state===n){continue}j.state=n;if(n){e.addClass(j.link,b);if(j.group){e.addClass(j.group,b)}if(j.dialog){if(typeof(n)==="object"){j.dialog.show(n)}else{j.dialog.hide()}}}else{e.removeClass(j.link,b);if(j.group){e.removeClass(j.group,b)}if(j.dialog){j.dialog.hide()}}}for(m in h){g=h[m];if(g.name==="change_view"){g.state=this.editor.currentView===this.editor.textarea;if(g.state){e.addClass(g.link,a)}else{e.removeClass(g.link,a)}}}},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}})})(wysihtml5);(function(c){var b;var a={name:b,style:true,toolbar:b,autoLink:true,parserRules:{tags:{br:{},span:{},div:{},p:{}},classes:{}},parser:c.dom.parse,composerClassName:"wysihtml5-editor",bodyClassName:"wysihtml5-supported",stylesheets:[],placeholderText:b,allowObjectResizing:true,supportTouchDevices:true};c.Editor=c.lang.Dispatcher.extend({constructor:function(g,d){this.textareaElement=typeof(g)==="string"?document.getElementById(g):g;this.config=c.lang.object({}).merge(a).merge(d).get();this.textarea=new c.views.Textarea(this,this.textareaElement,this.config);this.currentView=this.textarea;this._isCompatible=c.browser.supported();if(!this._isCompatible||(!this.config.supportTouchDevices&&c.browser.isTouchDevice())){var h=this;setTimeout(function(){h.fire("beforeload").fire("load")},0);return}c.dom.addClass(document.body,this.config.bodyClassName);this.composer=new c.views.Composer(this,this.textareaElement,this.config);this.currentView=this.composer;if(typeof(this.config.parser)==="function"){this._initParser()}this.observe("beforeload",function(){this.synchronizer=new c.views.Synchronizer(this,this.textarea,this.composer);if(this.config.toolbar){this.toolbar=new c.toolbar.Toolbar(this,this.config.toolbar)}});try{console.log("Heya! This page is using wysihtml5 for rich text editing. Check out https://github.com/xing/wysihtml5")}catch(f){}},isCompatible:function(){return this._isCompatible},clear:function(){this.currentView.clear();return this},getValue:function(d){return this.currentView.getValue(d)},setValue:function(d,e){if(!d){return this.clear()}this.currentView.setValue(d,e);return this},focus:function(d){this.currentView.focus(d);return this},disable:function(){this.currentView.disable();return this},enable:function(){this.currentView.enable();return this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},parse:function(d){var e=this.config.parser(d,this.config.parserRules,this.composer.sandbox.getDocument(),true);if(typeof(d)==="object"){c.quirks.redraw(d)}return e},_initParser:function(){this.observe("paste:composer",function(){var d=true,e=this;e.composer.selection.executeAndRestore(function(){c.quirks.cleanPastedHTML(e.composer.element);e.parse(e.composer.element)},d)});this.observe("paste:textarea",function(){var e=this.textarea.getValue(),d;d=this.parse(e);this.textarea.setValue(d)})}})})(wysihtml5);