/*
 * jQVMap Version 1.0
 *
 * http://jqvmap.com
 *
 * Copyright 2012, Peter Schmalfeldt <manifestinteractive@gmail.com>
 * Copyright 2011-2012, Kirill Lebedev
 * Licensed under the MIT license.
 *
 * Fork Me @ https://github.com/manifestinteractive/jqvmap
 */
(function(a){var c={colors:1,values:1,backgroundColor:1,scaleColors:1,normalizeFunction:1,enableZoom:1,showTooltip:1,borderColor:1,borderWidth:1,borderOpacity:1,selectedRegions:1,multiSelectRegion:1};var b={onLabelShow:"labelShow",onRegionOver:"regionMouseOver",onRegionOut:"regionMouseOut",onRegionClick:"regionClick",onRegionSelect:"regionSelect",onRegionDeselect:"regionDeselect"};a.fn.vectorMap=function(j){var g={map:"world_en",backgroundColor:"#a5bfdd",color:"#f4f3f0",hoverColor:"#c9dfaf",selectedColor:"#c9dfaf",scaleColors:["#b6d6ff","#005ace"],normalizeFunction:"linear",enableZoom:true,showTooltip:true,borderColor:"#818181",borderWidth:1,borderOpacity:0.25,selectedRegions:null,multiSelectRegion:false},i=this.data("mapObject");if(j==="addMap"){f.maps[arguments[1]]=arguments[2]}else{if(j==="set"&&c[arguments[1]]){i["set"+arguments[1].charAt(0).toUpperCase()+arguments[1].substr(1)].apply(i,Array.prototype.slice.call(arguments,2))}else{if(typeof j==="string"&&typeof i[j]==="function"){return i[j].apply(i,Array.prototype.slice.call(arguments,1))}else{a.extend(g,j);g.container=this;this.css({position:"relative",overflow:"hidden"});i=new f(g);this.data("mapObject",i);for(var h in b){if(g[h]){this.bind(b[h]+".jqvmap",g[h])}}}}}};var e=function(j,h,i){this.mode=window.SVGAngle?"svg":"vml";this.params=i;if(this.mode=="svg"){this.createSvgNode=function(k){return document.createElementNS(this.svgns,k)}}else{try{if(!document.namespaces.rvml){document.namespaces.add("rvml","urn:schemas-microsoft-com:vml")}this.createVmlNode=function(k){return document.createElement("<rvml:"+k+' class="rvml">')}}catch(g){this.createVmlNode=function(k){return document.createElement("<"+k+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}document.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)")}if(this.mode=="svg"){this.canvas=this.createSvgNode("svg")}else{this.canvas=this.createVmlNode("group");this.canvas.style.position="absolute"}this.setSize(j,h)};e.prototype={svgns:"http://www.w3.org/2000/svg",mode:"svg",width:0,height:0,canvas:null,setSize:function(m,g){if(this.mode=="svg"){this.canvas.setAttribute("width",m);this.canvas.setAttribute("height",g)}else{this.canvas.style.width=m+"px";this.canvas.style.height=g+"px";this.canvas.coordsize=m+" "+g;this.canvas.coordorigin="0 0";if(this.rootGroup){var k=this.rootGroup.getElementsByTagName("shape");for(var h=0,j=k.length;h<j;h++){k[h].coordsize=m+" "+g;k[h].style.width=m+"px";k[h].style.height=g+"px"}this.rootGroup.coordsize=m+" "+g;this.rootGroup.style.width=m+"px";this.rootGroup.style.height=g+"px"}}this.width=m;this.height=g},createPath:function(g){var i;if(this.mode=="svg"){i=this.createSvgNode("path");i.setAttribute("d",g.path);if(this.params.borderColor!==null){i.setAttribute("stroke",this.params.borderColor)}if(this.params.borderWidth>0){i.setAttribute("stroke-width",this.params.borderWidth);i.setAttribute("stroke-linecap","round");i.setAttribute("stroke-linejoin","round")}if(this.params.borderOpacity>0){i.setAttribute("stroke-opacity",this.params.borderOpacity)}i.setFill=function(k){this.setAttribute("fill",k);if(this.getAttribute("original")===null){this.setAttribute("original",k)}};i.getFill=function(k){return this.getAttribute("fill")};i.getOriginalFill=function(){return this.getAttribute("original")};i.setOpacity=function(k){this.setAttribute("fill-opacity",k)}}else{i=this.createVmlNode("shape");i.coordorigin="0 0";i.coordsize=this.width+" "+this.height;i.style.width=this.width+"px";i.style.height=this.height+"px";i.fillcolor=f.defaultFillColor;i.stroked=false;i.path=e.pathSvgToVml(g.path);var j=this.createVmlNode("skew");j.on=true;j.matrix="0.01,0,0,0.01,0,0";j.offset="0,0";i.appendChild(j);var h=this.createVmlNode("fill");i.appendChild(h);i.setFill=function(k){this.getElementsByTagName("fill")[0].color=k;if(this.getAttribute("original")===null){this.setAttribute("original",k)}};i.getFill=function(k){return this.getElementsByTagName("fill")[0].color};i.getOriginalFill=function(){return this.getAttribute("original")};i.setOpacity=function(k){this.getElementsByTagName("fill")[0].opacity=parseInt(k*100,10)+"%"}}return i},createGroup:function(g){var h;if(this.mode=="svg"){h=this.createSvgNode("g")}else{h=this.createVmlNode("group");h.style.width=this.width+"px";h.style.height=this.height+"px";h.style.left="0px";h.style.top="0px";h.coordorigin="0 0";h.coordsize=this.width+" "+this.height}if(g){this.rootGroup=h}return h},applyTransformParams:function(g,h,i){if(this.mode=="svg"){this.rootGroup.setAttribute("transform","scale("+g+") translate("+h+", "+i+")")}else{this.rootGroup.coordorigin=(this.width-h)+","+(this.height-i);this.rootGroup.coordsize=this.width/g+","+this.height/g}}};e.pathSvgToVml=function(k){var l="";var i=0,j=0,g,h;return k.replace(/([MmLlHhVvCcSs])((?:-?(?:\d+)?(?:\.\d+)?,?\s?)+)/g,function(r,q,m,o){m=m.replace(/(\d)-/g,"$1,-").replace(/\s+/g,",").split(",");if(!m[0]){m.shift()}for(var n=0,p=m.length;n<p;n++){m[n]=Math.round(100*m[n])}switch(q){case"m":i+=m[0];j+=m[1];return"t"+m.join(",");break;case"M":i=m[0];j=m[1];return"m"+m.join(",");break;case"l":i+=m[0];j+=m[1];return"r"+m.join(",");break;case"L":i=m[0];j=m[1];return"l"+m.join(",");break;case"h":i+=m[0];return"r"+m[0]+",0";break;case"H":i=m[0];return"l"+i+","+j;break;case"v":j+=m[0];return"r0,"+m[0];break;case"V":j=m[0];return"l"+i+","+j;break;case"c":g=i+m[m.length-4];h=j+m[m.length-3];i+=m[m.length-2];j+=m[m.length-1];return"v"+m.join(",");break;case"C":g=m[m.length-4];h=m[m.length-3];i=m[m.length-2];j=m[m.length-1];return"c"+m.join(",");break;case"s":m.unshift(j-h);m.unshift(i-g);g=i+m[m.length-4];h=j+m[m.length-3];i+=m[m.length-2];j+=m[m.length-1];return"v"+m.join(",");break;case"S":m.unshift(j+j-h);m.unshift(i+i-g);g=m[m.length-4];h=m[m.length-3];i=m[m.length-2];j=m[m.length-1];return"c"+m.join(",");break;default:return false;break}return""}).replace(/z/g,"")};var f=function(l){l=l||{};var i=this;var j=f.maps[l.map];this.selectedRegions=[];this.multiSelectRegion=l.multiSelectRegion;this.container=l.container;this.defaultWidth=j.width;this.defaultHeight=j.height;this.color=l.color;this.selectedColor=l.selectedColor;this.hoverColor=l.hoverColor;this.hoverOpacity=l.hoverOpacity;this.setBackgroundColor(l.backgroundColor);this.width=l.container.width();this.height=l.container.height();this.resize();jQuery(window).resize(function(){i.width=l.container.width();i.height=l.container.height();i.resize();i.canvas.setSize(i.width,i.height);i.applyTransform()});this.canvas=new e(this.width,this.height,l);l.container.append(this.canvas.canvas);this.makeDraggable();this.rootGroup=this.canvas.createGroup(true);this.index=f.mapIndex;this.label=jQuery("<div/>").addClass("jqvmap-label").appendTo(jQuery("body"));if(l.enableZoom){jQuery("<div/>").addClass("jqvmap-zoomin").text("+").appendTo(l.container);jQuery("<div/>").addClass("jqvmap-zoomout").html("&#x2212;").appendTo(l.container)}i.countries=[];for(var h in j.pathes){var m=this.canvas.createPath({path:j.pathes[h].path});m.setFill(this.color);m.id=i.getCountryId(h);i.countries[h]=m;if(this.canvas.mode=="svg"){m.setAttribute("class","jvectormap-region")}else{jQuery(m).addClass("jvectormap-region")}jQuery(this.rootGroup).append(m)}jQuery(l.container).delegate(this.canvas.mode=="svg"?"path":"shape","mouseover mouseout",function(n){var p=n.target,k=n.target.id.split("_").pop(),o=a.Event("labelShow.jqvmap"),q=a.Event("regionMouseOver.jqvmap");if(n.type=="mouseover"){jQuery(l.container).trigger(q,[k,j.pathes[k].name]);if(!q.isDefaultPrevented()){i.highlight(k,p)}if(l.showTooltip){i.label.text(j.pathes[k].name);jQuery(l.container).trigger(o,[i.label,k]);if(!o.isDefaultPrevented()){i.label.show();i.labelWidth=i.label.width();i.labelHeight=i.label.height()}}}else{i.unhighlight(k,p);i.label.hide();jQuery(l.container).trigger("regionMouseOut.jqvmap",[k,j.pathes[k].name])}});jQuery(l.container).delegate(this.canvas.mode=="svg"?"path":"shape","click",function(n){if(!l.multiSelectRegion){for(var o in j.pathes){i.countries[o].currentFillColor=i.countries[o].getOriginalFill();i.countries[o].setFill(i.countries[o].getOriginalFill())}}var p=n.target;var k=n.target.id.split("_").pop();jQuery(l.container).trigger("regionClick.jqvmap",[k,j.pathes[k].name]);if(i.selectedRegions.indexOf(k)!==-1){i.deselect(k,p)}else{i.select(k,p)}});if(l.showTooltip){l.container.mousemove(function(k){if(i.label.is(":visible")){i.label.css({left:k.pageX-15-i.labelWidth,top:k.pageY-15-i.labelHeight})}})}this.setColors(l.colors);this.canvas.canvas.appendChild(this.rootGroup);this.applyTransform();this.colorScale=new d(l.scaleColors,l.normalizeFunction,l.valueMin,l.valueMax);if(l.values){this.values=l.values;this.setValues(l.values)}if(l.selectedRegions){if(l.selectedRegions instanceof Array){for(var g in l.selectedRegions){this.select(l.selectedRegions[g].toLowerCase())}}else{this.select(l.selectedRegions.toLowerCase())}}this.bindZoomButtons();f.mapIndex++};f.prototype={transX:0,transY:0,scale:1,baseTransX:0,baseTransY:0,baseScale:1,width:0,height:0,countries:{},countriesColors:{},countriesData:{},zoomStep:1.4,zoomMaxStep:4,zoomCurStep:1,setColors:function(j,h){if(typeof j=="string"){this.countries[j].setFill(h);this.countries[j].setAttribute("original",h)}else{var i=j;for(var g in i){if(this.countries[g]){this.countries[g].setFill(i[g]);this.countries[g].setAttribute("original",i[g])}}}},setValues:function(l){var i=0,j=Number.MAX_VALUE,k;for(var g in l){k=parseFloat(l[g]);if(k>i){i=l[g]}if(k&&k<j){j=k}}this.colorScale.setMin(j);this.colorScale.setMax(i);var h={};for(g in l){k=parseFloat(l[g]);if(k){h[g]=this.colorScale.getColor(k)}else{h[g]=this.color}}this.setColors(h);this.values=l},setBackgroundColor:function(g){this.container.css("background-color",g)},setScaleColors:function(g){this.colorScale.setColors(g);if(this.values){this.setValues(this.values)}},setNormalizeFunction:function(g){this.colorScale.setNormalizeFunction(g);if(this.values){this.setValues(this.values)}},highlight:function(g,h){h=h||a("#"+this.getCountryId(g))[0];if(this.hoverOpacity){h.setOpacity(this.hoverOpacity)}else{if(this.hoverColor){h.currentFillColor=h.getFill()+"";h.setFill(this.hoverColor)}}},unhighlight:function(g,h){h=h||a("#"+this.getCountryId(g))[0];h.setOpacity(1);if(h.currentFillColor){h.setFill(h.currentFillColor)}},select:function(g,h){h=h||a("#"+this.getCountryId(g))[0];if(this.selectedRegions.indexOf(g)<0){if(this.multiSelectRegion){this.selectedRegions.push(g)}else{this.selectedRegions=[g]}a(this.container).trigger("regionSelect.jqvmap",[g]);if(this.selectedColor){h.currentFillColor=this.selectedColor;h.setFill(this.selectedColor)}}},deselect:function(g,h){h=h||a("#"+this.getCountryId(g))[0];if(this.selectedRegions.indexOf(g)>=0){this.selectedRegions.splice(this.selectedRegions.indexOf(g),1);a(this.container).trigger("regionDeselect.jqvmap",[g]);h.currentFillColor=h.getOriginalFill();h.setFill(h.getOriginalFill())}},isSelected:function(g){return this.selectedRegions.indexOf(g)>=0},resize:function(){var g=this.baseScale;if(this.width/this.height>this.defaultWidth/this.defaultHeight){this.baseScale=this.height/this.defaultHeight;this.baseTransX=Math.abs(this.width-this.defaultWidth*this.baseScale)/(2*this.baseScale)}else{this.baseScale=this.width/this.defaultWidth;this.baseTransY=Math.abs(this.height-this.defaultHeight*this.baseScale)/(2*this.baseScale)}this.scale*=this.baseScale/g;this.transX*=this.baseScale/g;this.transY*=this.baseScale/g},reset:function(){this.countryTitle.reset();for(var g in this.countries){this.countries[g].setFill(f.defaultColor)}this.scale=this.baseScale;this.transX=this.baseTransX;this.transY=this.baseTransY;this.applyTransform()},applyTransform:function(){var g,h,i,j;if(this.defaultWidth*this.scale<=this.width){g=(this.width-this.defaultWidth*this.scale)/(2*this.scale);i=(this.width-this.defaultWidth*this.scale)/(2*this.scale)}else{g=0;i=(this.width-this.defaultWidth*this.scale)/this.scale}if(this.defaultHeight*this.scale<=this.height){h=(this.height-this.defaultHeight*this.scale)/(2*this.scale);j=(this.height-this.defaultHeight*this.scale)/(2*this.scale)}else{h=0;j=(this.height-this.defaultHeight*this.scale)/this.scale}if(this.transY>h){this.transY=h}else{if(this.transY<j){this.transY=j}}if(this.transX>g){this.transX=g}else{if(this.transX<i){this.transX=i}}this.canvas.applyTransformParams(this.scale,this.transX,this.transY)},makeDraggable:function(){var g=false;var h,i;var j=this;j.isMoving=false;j.isMovingTimeout=false;this.container.mousemove(function(m){if(g){var k=j.transX;var l=j.transY;j.transX-=(h-m.pageX)/j.scale;j.transY-=(i-m.pageY)/j.scale;j.applyTransform();h=m.pageX;i=m.pageY;j.isMoving=true;if(j.isMovingTimeout){clearTimeout(j.isMovingTimeout)}}return false}).mousedown(function(k){g=true;h=k.pageX;i=k.pageY;return false}).mouseup(function(){g=false;j.isMovingTimeout=setTimeout(function(){j.isMoving=false},100);return false})},bindZoomButtons:function(){var g=this;var h=(jQuery("#zoom").innerHeight()-6*2-15*2-3*2-7-6)/(this.zoomMaxStep-this.zoomCurStep);this.container.find(".jqvmap-zoomin").click(function(){if(g.zoomCurStep<g.zoomMaxStep){var j=g.transX;var k=g.transY;var i=g.scale;g.transX-=(g.width/g.scale-g.width/(g.scale*g.zoomStep))/2;g.transY-=(g.height/g.scale-g.height/(g.scale*g.zoomStep))/2;g.setScale(g.scale*g.zoomStep);g.zoomCurStep++;jQuery("#zoomSlider").css("top",parseInt(jQuery("#zoomSlider").css("top"),10)-h)}});this.container.find(".jqvmap-zoomout").click(function(){if(g.zoomCurStep>1){var j=g.transX;var k=g.transY;var i=g.scale;g.transX+=(g.width/(g.scale/g.zoomStep)-g.width/g.scale)/2;g.transY+=(g.height/(g.scale/g.zoomStep)-g.height/g.scale)/2;g.setScale(g.scale/g.zoomStep);g.zoomCurStep--;jQuery("#zoomSlider").css("top",parseInt(jQuery("#zoomSlider").css("top"),10)+h)}})},setScale:function(g){this.scale=g;this.applyTransform()},getCountryId:function(g){return"jqvmap"+this.index+"_"+g}};f.xlink="http://www.w3.org/1999/xlink";f.mapIndex=1;f.maps={};var d=function(g,j,i,h){if(g){this.setColors(g)}if(j){this.setNormalizeFunction(j)}if(i){this.setMin(i)}if(i){this.setMax(h)}};d.prototype={colors:[],setMin:function(g){this.clearMinValue=g;if(typeof this.normalize==="function"){this.minValue=this.normalize(g)}else{this.minValue=g}},setMax:function(g){this.clearMaxValue=g;if(typeof this.normalize==="function"){this.maxValue=this.normalize(g)}else{this.maxValue=g}},setColors:function(g){for(var h=0;h<g.length;h++){g[h]=d.rgbToArray(g[h])}this.colors=g},setNormalizeFunction:function(g){if(g==="polynomial"){this.normalize=function(h){return Math.pow(h,0.2)}}else{if(g==="linear"){delete this.normalize}else{this.normalize=g}}this.setMin(this.clearMinValue);this.setMax(this.clearMaxValue)},getColor:function(o){if(typeof this.normalize==="function"){o=this.normalize(o)}var n=[];var j=0;var m;for(var k=0;k<this.colors.length-1;k++){m=this.vectorLength(this.vectorSubtract(this.colors[k+1],this.colors[k]));n.push(m);j+=m}var g=(this.maxValue-this.minValue)/j;for(k=0;k<n.length;k++){n[k]*=g}k=0;o-=this.minValue;while(o-n[k]>=0){o-=n[k];k++}var h;if(k==this.colors.length-1){h=this.vectorToNum(this.colors[k]).toString(16)}else{h=(this.vectorToNum(this.vectorAdd(this.colors[k],this.vectorMult(this.vectorSubtract(this.colors[k+1],this.colors[k]),(o)/(n[k]))))).toString(16)}while(h.length<6){h="0"+h}return"#"+h},vectorToNum:function(j){var h=0;for(var g=0;g<j.length;g++){h+=Math.round(j[g])*Math.pow(256,j.length-g-1)}return h},vectorSubtract:function(j,k){var h=[];for(var g=0;g<j.length;g++){h[g]=j[g]-k[g]}return h},vectorAdd:function(j,k){var h=[];for(var g=0;g<j.length;g++){h[g]=j[g]+k[g]}return h},vectorMult:function(k,h){var j=[];for(var g=0;g<k.length;g++){j[g]=k[g]*h}return j},vectorLength:function(j){var h=0;for(var g=0;g<j.length;g++){h+=j[g]*j[g]}return Math.sqrt(h)}};d.arrayToRgb=function(g){var k="#";var h;for(var j=0;j<g.length;j++){h=g[j].toString(16);k+=h.length==1?"0"+h:h}return k};d.rgbToArray=function(g){g=g.substr(1);return[parseInt(g.substr(0,2),16),parseInt(g.substr(2,2),16),parseInt(g.substr(4,2),16)]}})(jQuery);