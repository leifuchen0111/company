!function(a){var b=function(c,e){this.options=e;this.$element=a(c);var d=this.$element.attr("id");this.$container=a("<div/>",{id:"ms-"+d,"class":"ms-container"});this.$selectableContainer=a("<div/>",{"class":"ms-selectable"});this.$selectionContainer=a("<div/>",{"class":"ms-selection"});this.$selectableUl=a("<ul/>",{"class":"ms-list"});this.$selectionUl=a("<ul/>",{"class":"ms-list"});this.scrollTo=0;this.sanitizeRegexp=new RegExp("\\W+","gi")};b.prototype={constructor:b,init:function(){var l=this,d=this.$element;if(d.next(".ms-container").length===0){d.css({position:"absolute",left:"-9999px"});d.attr("id",d.attr("id")?d.attr("id"):"ms-"+Math.ceil(Math.random()*1000));var h=null,g=null,f=0,e='<li class="ms-optgroup-container"></li>',j='<ul class="ms-optgroup"></ul>',i='<li class="ms-optgroup-label"><span></span></li>';d.find("optgroup, option").each(function(){if(a(this).is("optgroup")){h="<span>"+a(this).attr("label")+"</span>";g="ms-"+d.attr("id")+"-optgroup-"+f;var q=a(this),r=a(e),t=a(e),u=a(i),s=a(i);if(l.options.selectableOptgroup){s.on("click",function(){var y=q.children(":not(:selected)").map(function(){return a(this).val()}).get();l.select(y)});u.on("click",function(){var y=q.children(":selected").map(function(){return a(this).val()}).get();l.deselect(y)})}s.html(h);r.attr("id",g+"-selectable").append(a(j).append(s));l.$selectableUl.append(r);u.html(h);t.attr("id",g+"-selection").append(a(j).append(u));l.$selectionUl.append(t);f++}else{var n="";for(var o=0;o<this.attributes.length;o++){var m=this.attributes[o];if(l.isDomNode(m.name)){n+=m.name+'="'+m.value+'" '}}var v=a("<li "+n+"><span>"+a(this).text()+"</span></li>"),w=v.clone();var x=a(this).val(),p=l.sanitize(x,l.sanitizeRegexp);v.data("ms-value",x).addClass("ms-elem-selectable").attr("id",p+"-selectable");w.data("ms-value",x).addClass("ms-elem-selection").attr("id",p+"-selection").hide();l.$selectionUl.find(".ms-optgroup-label").hide();if(a(this).prop("disabled")||d.prop("disabled")){if(this.selected){w.prop("disabled",true);w.addClass(l.options.disabledClass)}else{v.prop("disabled",true);v.addClass(l.options.disabledClass)}}if(g){l.$selectableUl.children("#"+g+"-selectable").find("ul").first().append(v);l.$selectionUl.children("#"+g+"-selection").find("ul").first().append(w)}else{l.$selectableUl.append(v);l.$selectionUl.append(w)}}});if(l.options.selectableHeader){l.$selectableContainer.append(l.options.selectableHeader)}l.$selectableContainer.append(l.$selectableUl);if(l.options.selectableFooter){l.$selectableContainer.append(l.options.selectableFooter)}if(l.options.selectionHeader){l.$selectionContainer.append(l.options.selectionHeader)}l.$selectionContainer.append(l.$selectionUl);if(l.options.selectionFooter){l.$selectionContainer.append(l.options.selectionFooter)}l.$container.append(l.$selectableContainer);l.$container.append(l.$selectionContainer);d.after(l.$container);l.$selectableUl.on("mouseenter",".ms-elem-selectable",function(){a("li",l.$container).removeClass("ms-hover");a(this).addClass("ms-hover")}).on("mouseleave",function(){a("li",l.$container).removeClass("ms-hover")});var c=l.options.dblClick?"dblclick":"click";l.$selectableUl.on(c,".ms-elem-selectable",function(){l.select(a(this).data("ms-value"))});l.$selectionUl.on(c,".ms-elem-selection",function(){l.deselect(a(this).data("ms-value"))});l.$selectionUl.on("mouseenter",".ms-elem-selection",function(){a("li",l.$selectionUl).removeClass("ms-hover");a(this).addClass("ms-hover")}).on("mouseleave",function(){a("li",l.$selectionUl).removeClass("ms-hover")});l.$selectableUl.on("focusin",function(){a(this).addClass("ms-focus");l.$selectionUl.focusout()}).on("focusout",function(){a(this).removeClass("ms-focus");a("li",l.$container).removeClass("ms-hover")});l.$selectionUl.on("focusin",function(){a(this).addClass("ms-focus")}).on("focusout",function(){a(this).removeClass("ms-focus");a("li",l.$container).removeClass("ms-hover")});d.on("focusin",function(){d.focusout();l.$selectableUl.focusin()}).on("focusout",function(){l.$selectableUl.removeClass("ms-focus");l.$selectionUl.removeClass("ms-focus")});d.onKeyDown=function(m,n){var A=l.$container.find("."+n).find(".ms-list"),r=A.find("li:visible:not(.ms-optgroup-label, .ms-optgroup-container)"),s=r.length,o=A.find("li.ms-hover"),p=o.length>0?r.index(o):-1,B=A.innerHeight(),q=r.first().outerHeight(true),w=Math.floor(B/q),C=null;if(m.keyCode===32){if(o.length>0){if(n==="ms-selectable"){l.select(o.data("ms-value"))}else{l.deselect(o.data("ms-value"))}r.removeClass("ms-hover");l.scrollTo=0;A.scrollTop(l.scrollTo)}}else{if(m.keyCode===40){if(r.length>0){var u=p+1,t=(s!==u)?r.eq(u):r.first(),v=t.position().top;C=A.position().top;r.removeClass("ms-hover");t.addClass("ms-hover");if(s===u){l.scrollTo=0}else{if(v>=(C+(w*q))){l.scrollTo+=q}}A.scrollTop(l.scrollTo)}}else{if(m.keyCode===38){if(r.length>0){var y=Math.max(p-1,-1),x=r.eq(y),z=x.position().top;C=A.position().top;r.removeClass("ms-hover");x.addClass("ms-hover");if(z<=C){l.scrollTo-=q}else{if(y<0){l.scrollTo=(s-w)*q}}A.scrollTop(l.scrollTo)}}else{if(m.keyCode===37||m.keyCode===39){if(l.$selectableUl.hasClass("ms-focus")){l.$selectableUl.focusout();l.$selectionUl.focusin()}else{l.$selectableUl.focusin();l.$selectionUl.focusout()}}}}}};d.on("keydown",function(m){if(d.is(":focus")){var n=l.$selectableUl.hasClass("ms-focus")?"ms-selectable":"ms-selection";d.onKeyDown(m,n)}})}var k=d.find("option:selected").map(function(){return a(this).val()}).get();l.select(k,"init");if(typeof l.options.afterInit==="function"){l.options.afterInit.call(this,this.$container)}},refresh:function(){a("#ms-"+this.$element.attr("id")).remove();this.init(this.options)},select:function(l,c){if(typeof l==="string"){l=[l]}var k=this,d=this.$element,e=a.map(l,function(m){return(k.sanitize(m,k.sanitizeRegexp))}),h=this.$selectableUl.find("#"+e.join("-selectable, #")+"-selectable").filter(":not(."+k.options.disabledClass+")"),j=this.$selectionUl.find("#"+e.join("-selection, #")+"-selection"),f=d.find("option").filter(function(){return(a.inArray(this.value,l)>-1)});if(h.length>0){h.addClass("ms-selected").hide();j.addClass("ms-selected").show();f.prop("selected",true);var g=k.$selectableUl.children(".ms-optgroup-container");if(g.length>0){g.each(function(){var m=a(this).find(".ms-elem-selectable");if(m.length===m.filter(".ms-selected").length){a(this).find(".ms-optgroup-label").hide()}});var i=k.$selectionUl.children(".ms-optgroup-container");i.each(function(){var m=a(this).find(".ms-elem-selection");if(m.filter(".ms-selected").length>0){a(this).find(".ms-optgroup-label").show()}})}if(c!=="init"){k.$selectionUl.focusout();k.$selectableUl.focusin();d.trigger("change");if(typeof k.options.afterSelect==="function"){k.options.afterSelect.call(this,l)}}}},deselect:function(k){if(typeof k==="string"){k=[k]}var j=this,c=this.$element,d=a.map(k,function(l){return(j.sanitize(l,j.sanitizeRegexp))}),g=this.$selectableUl.find("#"+d.join("-selectable, #")+"-selectable"),i=this.$selectionUl.find("#"+d.join("-selection, #")+"-selection").filter(".ms-selected"),e=c.find("option").filter(function(){return(a.inArray(this.value,k)>-1)});if(i.length>0){g.removeClass("ms-selected").show();i.removeClass("ms-selected").hide();e.prop("selected",false);var f=j.$selectableUl.children(".ms-optgroup-container");if(f.length>0){f.each(function(){var l=a(this).find(".ms-elem-selectable");if(l.filter(":not(.ms-selected)").length>0){a(this).find(".ms-optgroup-label").show()}});var h=j.$selectionUl.children(".ms-optgroup-container");h.each(function(){var l=a(this).find(".ms-elem-selection");if(l.filter(".ms-selected").length===0){a(this).find(".ms-optgroup-label").hide()}})}this.$selectableUl.focusout();this.$selectionUl.focusin();c.trigger("change");if(typeof j.options.afterDeselect==="function"){j.options.afterDeselect.call(this,k)}}},select_all:function(){var c=this.$element,e=c.val();c.find("option").prop("selected",true);this.$selectableUl.find(".ms-elem-selectable").addClass("ms-selected").hide();this.$selectionUl.find(".ms-optgroup-label").show();this.$selectableUl.find(".ms-optgroup-label").hide();this.$selectionUl.find(".ms-elem-selection").addClass("ms-selected").show();this.$selectionUl.focusin();this.$selectableUl.focusout();c.trigger("change");if(typeof this.options.afterSelect==="function"){var d=a.grep(c.val(),function(f){return a.inArray(f,e)<0});this.options.afterSelect.call(this,d)}},deselect_all:function(){var c=this.$element,d=c.val();c.find("option").prop("selected",false);this.$selectableUl.find(".ms-elem-selectable").removeClass("ms-selected").show();this.$selectionUl.find(".ms-optgroup-label").hide();this.$selectableUl.find(".ms-optgroup-label").show();this.$selectionUl.find(".ms-elem-selection").removeClass("ms-selected").hide();this.$selectableUl.focusin();this.$selectionUl.focusout();c.trigger("change");if(typeof this.options.afterDeselect==="function"){this.options.afterDeselect.call(this,d)}},isDomNode:function(c){return(c&&typeof c==="object"&&typeof c.nodeType==="number"&&typeof c.nodeName==="string")},sanitize:function(d,c){return(d.replace(c,"_"))}};a.fn.multiSelect=function(){var d=arguments[0],c=arguments;return this.each(function(){var e=a(this),f=e.data("multiselect"),g=a.extend({},a.fn.multiSelect.defaults,e.data(),typeof d==="object"&&d);if(!f){e.data("multiselect",(f=new b(this,g)))}if(typeof d==="string"){f[d](c[1])}else{f.init()}})};a.fn.multiSelect.defaults={selectableOptgroup:false,disabledClass:"disabled",dblClick:false};a.fn.multiSelect.Constructor=b}(window.jQuery);