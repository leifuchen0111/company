!function(a){var b=function(c,e){this.$element=a(c);this.type=this.$element.data("uploadtype")||(this.$element.find(".thumbnail").length>0?"image":"file");this.$input=this.$element.find(":file");if(this.$input.length===0){return}this.name=this.$input.attr("name")||e.name;this.$hidden=this.$element.find('input[type=hidden][name="'+this.name+'"]');if(this.$hidden.length===0){this.$hidden=a('<input type="hidden" />');this.$element.prepend(this.$hidden)}this.$preview=this.$element.find(".fileupload-preview");var d=this.$preview.css("height");if(this.$preview.css("display")!="inline"&&d!="0px"&&d!="none"){this.$preview.css("line-height",d)}this.original={exists:this.$element.hasClass("fileupload-exists"),preview:this.$preview.html(),hiddenVal:this.$hidden.val()};this.$remove=this.$element.find('[data-dismiss="fileupload"]');this.$element.find('[data-trigger="fileupload"]').on("click.fileupload",a.proxy(this.trigger,this));this.listen()};b.prototype={listen:function(){this.$input.on("change.fileupload",a.proxy(this.change,this));a(this.$input[0].form).on("reset.fileupload",a.proxy(this.reset,this));if(this.$remove){this.$remove.on("click.fileupload",a.proxy(this.clear,this))}},change:function(c,g){var f=c.target.files!==undefined?c.target.files[0]:(c.target.value?{name:c.target.value.replace(/^.+\\/,"")}:null);if(g==="clear"){return}if(!f){this.clear();return}this.$hidden.val("");this.$hidden.attr("name","");this.$input.attr("name",this.name);if(this.type==="image"&&this.$preview.length>0&&(typeof f.type!=="undefined"?f.type.match("image.*"):f.name.match("\\.(gif|png|jpe?g)$"))&&typeof FileReader!=="undefined"){var i=new FileReader();var h=this.$preview;var d=this.$element;i.onload=function(j){h.html('<img src="'+j.target.result+'" '+(h.css("max-height")!="none"?'style="max-height: '+h.css("max-height")+';"':"")+" />");d.addClass("fileupload-exists").removeClass("fileupload-new")};i.readAsDataURL(f)}else{this.$preview.text(f.name);this.$element.addClass("fileupload-exists").removeClass("fileupload-new")}},clear:function(c){this.$hidden.val("");this.$hidden.attr("name",this.name);this.$input.attr("name","");if(a.browser.msie){var d=this.$input.clone(true);this.$input.after(d);this.$input.remove();this.$input=d}else{this.$input.val("")}this.$preview.html("");this.$element.addClass("fileupload-new").removeClass("fileupload-exists");if(c){this.$input.trigger("change",["clear"]);c.preventDefault()}},reset:function(c){this.clear();this.$hidden.val(this.original.hiddenVal);this.$preview.html(this.original.preview);if(this.original.exists){this.$element.addClass("fileupload-exists").removeClass("fileupload-new")}else{this.$element.addClass("fileupload-new").removeClass("fileupload-exists")}},trigger:function(c){this.$input.trigger("click");c.preventDefault()}};a.fn.fileupload=function(c){return this.each(function(){var d=a(this),e=d.data("fileupload");if(!e){d.data("fileupload",(e=new b(this,c)))}if(typeof c=="string"){e[c]()}})};a.fn.fileupload.Constructor=b;a(function(){a("body").on("click.fileupload.data-api",'[data-provides="fileupload"]',function(f){var d=a(this);if(d.data("fileupload")){return}d.fileupload(d.data());var c=a(f.target).is("[data-dismiss=fileupload],[data-trigger=fileupload]")?a(f.target):a(f.target).parents("[data-dismiss=fileupload],[data-trigger=fileupload]").first();if(c.length>0){c.trigger("click.fileupload");f.preventDefault()}})})}(window.jQuery);